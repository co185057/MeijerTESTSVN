<state-machine>
    <!-- ============================================================================ -->
    <!-- Section:  Library definitions                                                -->
    <!-- ============================================================================ -->
    <library-list>
        <library>
            <library-name>SecurityManagerTab.dll</library-name>
            <comment>This library contains the actions specific to the Takeaway Belt
                for the Security Manager</comment>
        </library>
        <library>
            <library-name>SecurityManager.dll</library-name>
            <comment>This library contains the actions for the Security Manager</comment>
        </library>
    </library-list>
    <!-- ============================================================================ -->
    <!-- Section:  Timer definitions                                                  -->
    <!-- ============================================================================ -->
    <timer-list>
        <timer>
            <timer-name>db_lookup_timer</timer-name>
        </timer>
        <timer>
            <timer-name>forgiveness_timer</timer-name>
        </timer>
        <timer>
            <timer-name>delayed_timer</timer-name>
        </timer>
        <timer>
            <timer-name>quiet_mode_timer</timer-name>
        </timer>
        <timer>
            <timer-name>picking_up_items_timer</timer-name>
        </timer>
        <timer>
            <timer-name>unexpected_decrease_timer</timer-name>
        </timer>
        <timer>
            <timer-name>scale_initialization_timer</timer-name>
        </timer>
    </timer-list>
    <!-- ============================================================================ -->
    <!-- Section:  Constant definitions                                               -->
    <!-- ============================================================================ -->
    <constant-list>
        <constant>
            <constant-name>default_state_timeout</constant-name>
            <constant-value>2000</constant-value>
        </constant>
    </constant-list>
    <!-- ============================================================================ -->
    <!-- Section:  Variable definitions                                               -->
    <!-- ============================================================================ -->
    <variable-list>
        <variable>
            <var-name>belt_item_count</var-name>
            <initial-value>0</initial-value>
            <min-value>0</min-value>
        </variable>
        <variable>
            <var-name>item_removed_flag</var-name>
            <initial-value>0</initial-value>
        </variable>
        <variable>
            <var-name>SMM_WLDB_wt_entry_max</var-name>
            <initial-value>0</initial-value>
        </variable>
        <variable>
            <var-name>SMM_WLDB_wt_entry_counter</var-name>
            <initial-value>0</initial-value>
        </variable>
        <variable>
            <var-name>attract_quiet_mode_timeout_value</var-name>
            <initial-value>0</initial-value>
        </variable>
        <variable>
            <var-name>scale_initialization_timeout_value</var-name>
            <initial-value>0</initial-value>
        </variable>
        <variable>
            <var-name>attract_quiet_mode_violation</var-name>
            <initial-value>0</initial-value>
        </variable>
        <variable>
            <var-name>security_control_command_type</var-name>
            <initial-value>0</initial-value>
        </variable>
        <variable>
            <var-name>picking_up_items_flag</var-name>
            <initial-value>0</initial-value>
        </variable>
        <variable>
            <var-name>transport_item_flag</var-name>
            <initial-value>0</initial-value>
        </variable>
        <variable>
            <var-name>scan_and_bag_flag</var-name>
            <initial-value>0</initial-value>
        </variable>
        <variable>
            <var-name>bag_and_eas_flag</var-name>
            <initial-value>0</initial-value>
        </variable>
        <variable>
            <var-name>not_finalize_flag</var-name>
            <initial-value>1</initial-value>
        </variable>
        <variable>
            <var-name>not_complete_flag</var-name>
            <initial-value>1</initial-value>
        </variable>
        <variable>
            <var-name>finalize_flag</var-name>
            <initial-value>0</initial-value>
        </variable>
        <variable>
            <var-name>picking_up_items_timeout_value</var-name>
            <initial-value>0</initial-value>
        </variable>
        <variable>
            <var-name>unexpected_decrease_timeout_value</var-name>
            <initial-value>0</initial-value>
        </variable>
        <variable>
            <var-name>forgiveness_timeout_value</var-name>
            <initial-value>0</initial-value>
        </variable>
        <variable>
            <var-name>delayed_timeout_value</var-name>
            <initial-value>0</initial-value>
        </variable>
        <variable>
            <var-name>X</var-name>
            <initial-value>0</initial-value>
            <max-value />
            <min-value>0</min-value>
        </variable>
        <variable>
            <var-name>A</var-name>
            <initial-value>0</initial-value>
            <max-value />
            <min-value>0</min-value>
        </variable>
        <variable>
            <comment>This counter keeps track of the number of items</comment>
            <var-name>ItemCounter</var-name>
            <initial-value>0</initial-value>
            <max-value />
            <min-value>0</min-value>
        </variable>
        <variable>
            <var-name>unexpected_decrease_flag</var-name>
            <initial-value>0</initial-value>
        </variable>
        <variable>
            <var-name>lane_closed_flag</var-name>
            <initial-value>0</initial-value>
        </variable>
        <variable>
        <var-name>multi_pick_flag</var-name>
            <initial-value>0</initial-value>
        </variable>   
        <variable>
        <var-name>skip_bagging_in_multi_pick_flag</var-name>
            <initial-value>0</initial-value>
        </variable>
		<!-- 389091 -->
        <variable>
            <var-name>UI_SkipBagging_threshold</var-name>
            <initial-value>0</initial-value>
        </variable>
    </variable-list>
    <!-- ============================================================================ -->
    <!-- Section:  State definitions                                                  -->
    <!-- ============================================================================ -->
    <state-list>
        <state-definition>
            <comment>This is the initial state entered</comment>
            <state-name>Uninitialized</state-name>
            <initial />
        </state-definition>
        <state-definition>
            <state-name>InitPhase1</state-name>
        </state-definition>
        <state-definition>
            <state-name>InitPhase2</state-name>
        </state-definition>
        <state-definition>
            <state-name>InitPhase3</state-name>
        </state-definition>
        <state-definition>
            <state-name>InitPhase4</state-name>
        </state-definition>
        <state-definition>
            <state-name>InitPhase5</state-name>
        </state-definition>
        <state-definition>
            <comment>Nothing going on</comment>
            <state-name>Idle</state-name>
        </state-definition>
        <state-definition>
            <comment>This state occurs after the user has scanned the first item or pressed Start</comment>
            <state-name>Start</state-name>
        </state-definition>
        <state-definition>
            <state-name>Wait DB</state-name>
        </state-definition>
        <state-definition>
            <state-name>Wait Scale</state-name>
        </state-definition>
        <state-definition>
            <state-name>Wait Scale - Skip Bagging Pressed</state-name>
        </state-definition>
        <state-definition>
            <state-name>Wait Scale - Quantity Item</state-name>
        </state-definition>
        <state-definition>
            <state-name>Item Entry</state-name>
        </state-definition>
        <state-definition>
            <state-name>Complete</state-name>
        </state-definition>
        <state-definition>
            <state-name>Finalize</state-name>
        </state-definition>
        <state-definition>
            <state-name>Security Maintenance</state-name>
        </state-definition>
        <state-definition>
            <state-name>Security Maintenance - Add Weight</state-name>
        </state-definition>
        <state-definition>
            <state-name>Security Maintenance - Add Tolerance</state-name>
        </state-definition>
        <state-definition>
            <state-name>Security Maintenance - Add Substitution Check</state-name>
        </state-definition>
        <state-definition>
            <state-name>Security Maintenance - Add Wt Required</state-name>
        </state-definition>
        <state-definition>
            <state-name>Security Maintenance - Add Zero Wt</state-name>
        </state-definition>
        <state-definition>
            <state-name>Security Maintenance - Delete All Wts</state-name>
        </state-definition>
        <state-definition>
            <state-name>Security Maintenance - Delete Tolerance</state-name>
        </state-definition>
        <state-definition>
            <state-name>Item Voided</state-name>
        </state-definition>
        <state-definition>
            <state-name>Transaction Voided</state-name>
        </state-definition>
        <state-definition>
            <state-name>Assist Mode</state-name>
        </state-definition>
        <state-definition>
            <state-name>Assist Mode - Item In Progress</state-name>
        </state-definition>
        <state-definition>
            <state-name>Remote Assist Mode</state-name>
        </state-definition>
    </state-list>
    <!-- ============================================================================ -->
    <!-- Section:  Message definitions                                                -->
    <!-- ============================================================================ -->
    <msg-list>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Item Sold</msg-name>
            <msg-value>0x00000001</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from DB (internal)</comment>
            <msg-name>DB Response</msg-name>
            <msg-value>0x10000001</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from Scale (internal)</comment>
            <msg-name>Matched Wt</msg-name>
            <msg-value>0x10000002</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from Scale (internal)</comment>
            <msg-name>Unmatched Wt</msg-name>
            <msg-value>0x10000003</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from Scale (internal)</comment>
            <msg-name>BackToLGW</msg-name>
            <msg-value>0x10000004</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from DBMgr (internal)</comment>
            <msg-name>Dept Details</msg-name>
            <msg-value>0x10000005</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from Scale (internal)</comment>
            <msg-name>Unmatched Increase</msg-name>
            <msg-value>0x10000006</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from Scale (internal)</comment>
            <msg-name>Unmatched Decrease</msg-name>
            <msg-value>0x10000007</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from Scale (internal)</comment>
            <msg-name>Device Failure</msg-name>
            <msg-value>0x10000008</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Item Void</msg-name>
            <msg-value>0x00000003</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Transaction Voided</msg-name>
            <msg-value>0x00000004</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Item Removed</msg-name>
            <msg-value>0x00000005</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Skip Bagging</msg-name>
            <msg-value>0x00000006</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Initialize</msg-name>
            <msg-value>0x00000007</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Item Details</msg-name>
            <msg-value>0x00000008</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Application Control</msg-name>
            <msg-value>0x00000009</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Security Control</msg-name>
            <msg-value>0x0000000a</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Transaction Control</msg-name>
            <msg-value>0x0000000b</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Transaction Begin</msg-name>
            <msg-value>0x0000000c</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Transaction End</msg-name>
            <msg-value>0x0000000d</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Transaction Void</msg-name>
            <msg-value>0x0000000e</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Override Exception</msg-name>
            <msg-value>0x0000000f</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Clear Exception</msg-name>
            <msg-value>0x00000010</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Ignore Exception</msg-name>
            <msg-value>0x00000011</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Throw Exception</msg-name>
            <msg-value>0x00000012</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Item Validated</msg-name>
            <msg-value>0x00000013</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Abort</msg-name>
            <msg-value>0x00000014</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane - Application Control - Set Application State</comment>
            <msg-name>Set Application State</msg-name>
            <msg-value>0x00000015</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Clear Exception with Update</msg-name>
            <msg-value>0x00000016</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Security Maintenance</msg-name>
            <msg-value>0x00000017</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>SMM Query</msg-name>
            <msg-value>0x00000018</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>SMM Update</msg-name>
            <msg-value>0x00000019</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>SMM Begin</msg-name>
            <msg-value>0x0000001a</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>SMM End</msg-name>
            <msg-value>0x0000001b</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>SMM Update - Add Weight</msg-name>
            <msg-value>0x0000001c</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>SMM Update - Add Zero</msg-name>
            <msg-value>0x0000001d</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>SMM Update - Add Tolerance</msg-name>
            <msg-value>0x0000001e</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>SMM Update - Delete Tolerance</msg-name>
            <msg-value>0x0000001f</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>SMM Update - Delete All Weights</msg-name>
            <msg-value>0x00000020</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>SMM Update - Add Substitution Check</msg-name>
            <msg-value>0x00000021</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>SMM Update - Add Wt Required</msg-name>
            <msg-value>0x00000021</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>RAP Approved Wt</msg-name>
            <msg-value>0x00000022</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Clear All Exceptions</msg-name>
            <msg-value>0x00000023</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Bag Box Button Pressed</msg-name>
            <msg-value>0x00000024</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Hold Weight Command</msg-name>
            <msg-value>0x00000025</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Resume Weight Command</msg-name>
            <msg-value>0x00000026</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Reload Options</msg-name>
            <msg-value>0x00000027</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Transaction Finalize</msg-name>
            <msg-value>0x00000028</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Transaction Continue</msg-name>
            <msg-value>0x00000029</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Item Expired</msg-name>
            <msg-value>0x0000002a</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Clear Exception - All Wt Changes</msg-name>
            <msg-value>0x0000002b</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>SMM Cancel</msg-name>
            <msg-value>0x0000002c</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Clear Delayed Exception</msg-name>
            <msg-value>0x0000002d</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Attract Quiet Mode Violation</msg-name>
            <msg-value>0x0000002e</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Transaction Expired</msg-name>
            <msg-value>0x0000002f</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Item Not Sellable</msg-name>
            <msg-value>0x00000030</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Clear Exception if Item Match</msg-name>
            <msg-value>0x00000031</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Item Void Begin</msg-name>
            <msg-value>0x00000032</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Item Void End</msg-name>
            <msg-value>0x00000033</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Transaction Void Begin</msg-name>
            <msg-value>0x00000034</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Transaction Void End</msg-name>
            <msg-value>0x00000035</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Void Item Late Correction</msg-name>
            <msg-value>0x00000036</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Zero Wt</msg-name>
            <msg-value>0x00000037</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Enter Assist Mode</msg-name>
            <msg-value>0x00000038</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Exit Assist Mode</msg-name>
            <msg-value>0x00000039</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Skip Bagging2</msg-name>
            <msg-value>0x0000003a</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Clear Scale</msg-name>
            <msg-value>0x0000003b</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Flush Item</msg-name>
            <msg-value>0x0000003c</msg-value>
        </msg-definition>
<!-- +TAR 278124 -->            
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Scale Not Empty</msg-name>
            <msg-value>0x0000003d</msg-value>
        </msg-definition>
<!-- -TAR 278124 -->            
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Enter Scan And Bag</msg-name>
            <msg-value>0x0000003e</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Enter Thank You</msg-name>
            <msg-value>0x0000003f</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Enter Remote Assist Mode</msg-name>
            <msg-value>0x00000040</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Exit Remote Assist Mode</msg-name>
            <msg-value>0x00000041</msg-value>
        </msg-definition>
        <!-- Message received from the DM Client Mgr -->
        <msg-definition>
            <comment>Received from DBClientMgr</comment>
            <msg-name>SMM Working Status</msg-name>
            <msg-value>0x20000001</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from DBClientMgr</comment>
            <msg-name>SMM WLDB Weight</msg-name>
            <msg-value>0x20000002</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from DBClientMgr</comment>
            <msg-name>DB Mgr Status</msg-name>
            <msg-value>0x20000003</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from DBClientMgr</comment>
            <msg-name>SMM Tolerance</msg-name>
            <msg-value>0x20000004</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from DBClientMgr</comment>
            <msg-name>SMM WLDB Update Complete</msg-name>
            <msg-value>0x20000005</msg-value>
        </msg-definition>
        <!-- Message received from the TakeawayBelt -->
        <msg-definition>
            <comment>Received from TakeawayBelt</comment>
            <msg-name>Takeaway Belt Data Event</msg-name>
            <msg-value>0x30000001</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from TakeawayBelt</comment>
            <msg-name>Takeaway Belt - Not Ready</msg-name>
            <msg-value>0x30000400</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from TakeawayBelt</comment>
            <msg-name>Takeaway Belt - Ready</msg-name>
            <msg-value>0x30000401</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from TakeawayBelt</comment>
            <msg-name>Takeaway Belt - Item Moved Off Belt1</msg-name>
            <msg-value>0x30000402</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from TakeawayBelt</comment>
            <msg-name>Takeaway Belt - Bag Area Backup</msg-name>
            <msg-value>0x30000411</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from TakeawayBelt</comment>
            <msg-name>Takeaway Belt - Bag Area Clear</msg-name>
            <msg-value>0x30000410</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from TakeawayBelt</comment>
            <msg-name>Takeaway Belt - Cover Open</msg-name>
            <msg-value>0x30000420</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from TakeawayBelt</comment>
            <msg-name>Takeaway Belt - Cover Closed</msg-name>
            <msg-value>0x30000421</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from TakeawayBelt</comment>
            <msg-name>Takeaway Belt - Scale Status Requested</msg-name>
            <msg-value>0x30000440</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from TakeawayBelt</comment>
            <msg-name>Takeaway Belt - Assist Mode Done</msg-name>
            <msg-value>0x30000441</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from SecurityManager</comment>
            <msg-name>Set LGW From Authorization</msg-name>
            <msg-value>0x40000001</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from SecurityManager</comment>
            <msg-name>Clear Exception - All Immediate Wt Changes</msg-name>
            <msg-value>0x40000002</msg-value>
        </msg-definition>
		<msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Clear All Exceptions No Change State</msg-name>
            <msg-value>0x2000000c</msg-value>
        </msg-definition>
        <msg-definition>
            <comment>Received from SecurityManager</comment>
            <msg-name>Skip Bagging3</msg-name>
            <msg-value>0x2000000d</msg-value>
        </msg-definition>     
        <msg-definition>
            <comment>Received from FastLane</comment>
            <msg-name>Item Validated Not Send Item OK</msg-name>
            <msg-value>0x2000000e</msg-value>
        </msg-definition>   
        <msg-definition>
            <comment>Received from SecurityManager</comment>
            <msg-name>Wait Scale - Skipbagging - flush</msg-name>
            <msg-value>0x40000003</msg-value>
        </msg-definition>
<!-- sscob-1558 -->
	<msg-definition>
            <comment>Received from SecurityManager</comment>
            <msg-name>Bad Weight At Attract</msg-name>
            <msg-value>0x40000004</msg-value>
	</msg-definition>


    </msg-list>
    <!-- ============================================================================ -->
    <!-- Section:  Action definitions                                                 -->
    <!-- ============================================================================ -->
    <action-list>
        <action>
            <action-name>SendDBRequest</action-name>
        </action>
        <action>
            <action-name>SendWtRequestToScale</action-name>
        </action>
        <action>
            <action-name>CheckTransactionComplete</action-name>
        </action>
        <action>
            <action-name>SendSecurityViolations</action-name>
        </action>
        <action>
            <action-name>SendSecurityViolation</action-name>
        </action>
        <action>
            <action-name>ResetTransaction</action-name>
        </action>
        <action>
            <action-name>CheckScaleNotEmpty</action-name>
        </action>
        <action>
            <action-name>SendItemOK</action-name>
        </action>
        <action>
            <action-name>GlobalLog</action-name>
        </action>
        <action>
            <action-name>LoadConfiguration</action-name>
        </action>
        <action>
            <action-name>LoadWTInfo</action-name>
        </action>
        <action>
            <action-name>LoadDBMgrClient</action-name>
        </action>
        <action>
            <action-name>LoadSmartScaleTAB</action-name>
        </action>
        <action>
            <action-name>LoadTakeawayBelt</action-name>
        </action>
        <action>
            <action-name>InitializationComplete</action-name>
        </action>
        <action>
            <action-name>AddItemToTransaction</action-name>
        </action>
        <action>
            <action-name>ItemNotScannedAdjustment</action-name>
        </action>
        <action>
            <action-name>SendLastChanceLookupDBRequest</action-name>
        </action>
        <action>
            <action-name>CheckItemDetails</action-name>
        </action>
        <action>
            <action-name>CheckDeptDetails</action-name>
        </action>
        <action>
            <action-name>HandleTABMatchedWt</action-name>
        </action>
        <action>
            <action-name>HandleTABUnmatchedWt</action-name>
        </action>
        <action>
            <action-name>HandleTABUnmatchedIncrease</action-name>
        </action>
        <action>
            <action-name>HandleTABUnmatchedDecrease</action-name>
        </action>
        <action>
            <action-name>TransactionControlCommand</action-name>
        </action>
        <action>
            <action-name>ApplicationControlCommand</action-name>
        </action>
        <action>
            <action-name>SecurityControlCommandTAB</action-name>
        </action>
        <action>
            <action-name>StartTransaction</action-name>
        </action>
        <action>
            <action-name>CheckDBResponse</action-name>
        </action>
        <action>
            <action-name>CheckForExceptions</action-name>
        </action>
        <action>
            <action-name>ClearOutstandingExceptions</action-name>
        </action>
        <action>
            <action-name>SetLastGoodWeight</action-name>
        </action>
        <action>
            <action-name>SetBeginningTransLGW</action-name>
        </action>
        <action>
            <action-name>SetHoldWeight</action-name>
        </action>
        <action>
            <action-name>ClearHoldWeight</action-name>
        </action>
        <action>
            <action-name>OverrideExceptionCommand</action-name>
        </action>
        <action>
            <action-name>ClearException</action-name>
        </action>
        <action>
            <action-name>ClearLastException</action-name>
        </action>
        <action>
            <action-name>IgnoreException</action-name>
        </action>
        <action>
            <action-name>ThrowException</action-name>
        </action>
        <action>
            <action-name>IsExceptionForgiven</action-name>
        </action>
        <action>
            <action-name>IsExceptionDelayed</action-name>
        </action>
        <action>
            <action-name>ClearForgivenException</action-name>
        </action>
        <action>
            <action-name>ClearDelayedException</action-name>
        </action>
        <action>
            <action-name>UnloadTakeawayBelt</action-name>
        </action>
        <action>
            <action-name>UnloadDBMgrClient</action-name>
        </action>
        <action>
            <action-name>UnloadSmartScale</action-name>
        </action>
        <action>
            <action-name>UnloadWTInfo</action-name>
        </action>
        <action>
            <action-name>UnloadConfiguration</action-name>
        </action>
        <action>
            <action-name>ValidateItem</action-name>
        </action>
        <action>
            <action-name>SetApplicationStateCommandTAB</action-name>
        </action>
        <action>
            <action-name>ReadScaleForZero</action-name>
        </action>
        <action>
            <action-name>ClearAllExceptions</action-name>
        </action>
        <action>
            <action-name>UpdateWLDB</action-name>
        </action>
        <action>
            <action-name>HandleRAPApprovedWt</action-name>
        </action>
        <action>
            <action-name>SecurityMaintenanceCommand</action-name>
        </action>
        <action>
            <action-name>SMMBegin</action-name>
        </action>
        <action>
            <action-name>SMMUpdateAddWeight</action-name>
        </action>
        <action>
            <action-name>SMMUpdateAddZero</action-name>
        </action>
        <action>
            <action-name>SMMUpdateAddTolerance</action-name>
        </action>
        <action>
            <action-name>SMMUpdateDeleteTolerance</action-name>
        </action>
        <action>
            <action-name>SMMUpdateDeleteAllWts</action-name>
        </action>
        <action>
            <action-name>SMMCheckToleranceValue</action-name>
        </action>
        <action>
            <action-name>SendSMMUpdateAddToleranceResponse</action-name>
        </action>
        <action>
            <action-name>SendSMMServerFailure</action-name>
        </action>
        <action>
            <action-name>SetSMMCurrentWeight</action-name>
        </action>
        <action>
            <action-name>SMMEnd</action-name>
        </action>
        <action>
            <action-name>CheckSkipBagging</action-name>
        </action>
        <action>
            <action-name>CheckItemRemoved</action-name>
        </action>
        <action>
            <action-name>CheckBagBox</action-name>
        </action>
        <action>
            <action-name>CheckItemRemovedAutoAdvance</action-name>
        </action>
        <action>
            <action-name>VoidTransaction</action-name>
        </action>
        <action>
            <action-name>SMMQuery</action-name>
        </action>
        <action>
            <action-name>SMMDBResponse</action-name>
        </action>
        <action>
            <action-name>SaveSMMToleranceData</action-name>
        </action>
        <action>
            <action-name>GetSMMWLDBData</action-name>
        </action>
        <action>
            <action-name>SendSMMQueryResponse</action-name>
        </action>
        <action>
            <action-name>HandleSMMUnmatchedIncrease</action-name>
        </action>
        <action>
            <action-name>SMMAddWtToWLDB</action-name>
        </action>
        <action>
            <action-name>BuildSMMQueryResponse</action-name>
        </action>
        <action>
            <action-name>SMMUpdateAddSubstitutionCheck</action-name>
        </action>
        <action>
            <action-name>SMMUpdateAddWtRequired</action-name>
        </action>
        <action>
            <action-name>UpdateWLDBZeroWt</action-name>
        </action>
        <action>
            <action-name>IsItemRemovedAutoAdvanceEnabled</action-name>
        </action>
        <action>
            <action-name>IsRemoveItemViolationAutoAdvanceEnabled</action-name>
        </action>
        <action>
            <action-name>ClearUnexpectedDecrease</action-name>
        </action>
        <action>
            <action-name>CheckQuietModeAttract</action-name>
        </action>
        <action>
            <action-name>CheckRememberVirtualZero</action-name>
        </action>
        <action>
            <action-name>CheckQuietModeViolation</action-name>
        </action>
        <action>
            <action-name>SetInAttract</action-name>
        </action>
        <action>
            <action-name>GetCommand</action-name>
        </action>
        <action>
            <action-name>SetCommand</action-name>
        </action>
        <action>
            <action-name>SerializeCommand</action-name>
        </action>
        <action>
            <action-name>AbortCommand</action-name>
        </action>
        <action>
            <action-name>ReloadConfiguration</action-name>
        </action>
        <action>
            <action-name>ResetWeight</action-name>
        </action>
        <action>
            <action-name>HandleUnmatchedIncreaseLateCorrection</action-name>
        </action>
        <action>
            <action-name>HandleSmartScaleFailure</action-name>
        </action>
        <action>
            <action-name>HandleDBMgrClientFailure</action-name>
        </action>
        <action>
            <action-name>QueryDeviceStatusCommand</action-name>
        </action>
        <action>
            <action-name>SetForgivenessTimeout</action-name>
        </action>
        <action>
            <action-name>SetDelayedTimeout</action-name>
        </action>
        <action>
            <action-name>SetPickingUpItemsTimeout</action-name>
        </action>
        <action>
            <action-name>SetUnexpectedDecreaseTimeout</action-name>
        </action>
        <action>
            <action-name>SetScaleInitializationTimeout</action-name>
        </action>
        <action>
            <action-name>UpdateWLDBForgivenMismatch</action-name>
        </action>
        <action>
            <action-name>UpdateWLDBDelayedNewItemThreshold</action-name>
        </action>
        <action>
            <action-name>SaveInitializeParameters</action-name>
        </action>
        <action>
            <action-name>SendObservedWeight</action-name>
        </action>
        <action>
            <action-name>SendSMMObservedWeight</action-name>
        </action>
        <!-- +TAB Issue 41 -->
        <action>
            <action-name>ResetSmartScaleTimers</action-name>
        </action>
        <!-- -TAB Issue 41 -->
        <!-- +TAB Issue 45 -->
        <action>
            <action-name>ResetSMMObservedWeight</action-name>
        </action>
        <!-- -TAB Issue 45 -->
        <action>
            <action-name>SendTransactionComplete</action-name>
        </action>
        <action>
            <action-name>SaveLastRemovedWeight</action-name>
        </action>
        <action>
            <action-name>HandleShuffle</action-name>
        </action>
        <action>
            <action-name>IsTransactionEmpty</action-name>
        </action>
        <action>
            <action-name>RemoveItemFromTransaction</action-name>
        </action>
        <action>
            <action-name>IsExceptionInterventionReq</action-name>
        </action>
        <action>
            <action-name>ResetAtItemScanForTAB</action-name>
        </action>
        <action>
            <action-name>ClearLastWtException</action-name>
        </action>
        <action>
            <action-name>VoidItemCommand</action-name>
        </action>
        <action>
            <action-name>ClearAllWtExceptions</action-name>
        </action>
        <action>
            <action-name>DisableLateCorrection</action-name>
        </action>
        <action>
            <action-name>TakeawayBeltStatus</action-name>
        </action>
        <action>
            <action-name>FlushTABInAttract</action-name>
        </action>
        <action>
            <action-name>NotifyTakeawayBelt</action-name>
        </action>
        <action>
            <action-name>SendTABStatus</action-name>
        </action>
        <action>
            <action-name>SendScaleStatusToTAB</action-name>
        </action>
        <action>
            <action-name>HandleTABCover</action-name>
        </action>
        <action>
            <action-name>CheckTABQuantityItem</action-name>
        </action>
        <action>
            <action-name>ReadyTABForNextItem</action-name>
        </action>
        <action>
            <action-name>IsNotQuantityItem</action-name>
        </action>
        <action>
            <action-name>HandleTABQuantityUnmatchedIncrease</action-name>
        </action>
<!-- +TAR 276877 -->        
        <action>
            <action-name>ClearAllMismatchesThisItem</action-name>
        </action>
<!-- -TAR 276877 -->   
        <action>
            <action-name>ClearAllImmediateWtChanges</action-name>
        </action>     
        <action>
            <action-name>IsNoWtInterventionOutstanding</action-name>
        </action>
        <action>
            <action-name>IsCurrentExceptionDelayed</action-name>
        </action>        
        <action>
            <action-name>send-msg</action-name>
        </action>
        <action>
            <action-name>pop-state</action-name>
        </action>
        <action>
            <action-name>push-state</action-name>
        </action>
        <action>
            <action-name>increment-variable</action-name>
        </action>
        <action>
            <action-name>decrement-variable</action-name>
        </action>
        <action>
            <action-name>assign-variable</action-name>
        </action>
        <action>
            <action-name>start-timer</action-name>
        </action>
        <action>
            <action-name>stop-timer</action-name>
        </action>
        <action>
            <action-name>wait-timer</action-name>
        </action>
        <action>
            <action-name>resend-msg</action-name>
        </action>
        <action>
            <action-name>evaluate-expression</action-name>
        </action>
        <action>
            <action-name>set-return-code</action-name>
        </action>
        <action>
            <action-name>SendItemPickFinish</action-name>
        </action>  
		<action>
            <action-name>SendGoToScanAndBag</action-name>
        </action>
    </action-list>
    <!-- ============================================================================ -->
    <!-- Section:  Application State definitions                                      -->
    <!-- Note:  This section must follow the <state-list>, <action-list>,             -->
    <!--        <message-list>, and <variable-list> sections.  DO NOT MOVE.           -->
    <!-- ============================================================================ -->
    <application-state-list>
        <application-state>
            <comment>This is VoidApproval and VoidTransApproval states</comment>
            <state-name>ApproveVoidedItem</state-name>
            <do-not-hold-weight />
        </application-state>
        <application-state>
            <comment>This is Attract state</comment>
            <state-name>Attract</state-name>
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>SetBeginningTransLGW</action-name>
                        <parameter>
                            <value>set-beginningtranslgw-attract</value>
                        </parameter>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>SetInAttract</action-name>
                        <parameter>
                            <value>true</value>
                        </parameter>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>FlushTABInAttract</action-name>
                    </action>
                </rule>
            </entry-rule-list>
            <takeaway-belt>reset</takeaway-belt>                        
            <exit-rule-list>
                <rule>
                    <action>
                        <action-name>SetInAttract</action-name>
                        <parameter>
                            <value>false</value>
                        </parameter>
                    </action>
                </rule>
            </exit-rule-list>
        </application-state>
        <application-state>
            <comment>This is BagAndEAS state</comment>
            <state-name>BagAndEAS</state-name>
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>bag_and_eas_flag</value>
                        </parameter>
                        <parameter>
                            <value>1</value>
                        </parameter>
                    </action>
                </rule>
            </entry-rule-list>
            <exit-rule-list>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>bag_and_eas_flag</value>
                        </parameter>
                        <parameter>
                            <value>0</value>
                        </parameter>
                    </action>
                </rule>
            </exit-rule-list>
        </application-state>
        <application-state>
            <state-name>CardMisRead</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
        </application-state>
        <application-state>
            <state-name>CheckBasketReminder</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
        </application-state>
        <application-state>
            <state-name>ContextHelp</state-name>
            <do-not-hold-weight />
        </application-state>
        <application-state>
            <state-name>CouponNoMatch</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
        </application-state>
        <application-state>
            <state-name>CouponNotAllowed</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
        </application-state>
        <application-state>
            <state-name>CouponTooHigh</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
        </application-state>
        <application-state>
            <state-name>CrateableItem</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
        </application-state>
        <application-state>
            <state-name>EnterCouponValue</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
        </application-state>
        <application-state>
            <comment>This is EnterPin state</comment>
            <state-name>EnterPin</state-name>
            <hold-weight />
            <push-hold-weight />
        </application-state>
        <application-state>
            <state-name>EnterQuantity</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
        </application-state>
        <application-state>
            <state-name>EnterWeight</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
        </application-state>
        <application-state>
            <comment>This is Finalize state</comment>
            <state-name>Finalize</state-name>
        </application-state>
        <application-state>
            <state-name>Finish</state-name>
            <!--hold-weight /-->
            <takeaway-belt>stop-belt</takeaway-belt>
        </application-state>
         <!-- MEIJER TAR 327614, new state requires security option             -->
       <application-state>
            <state-name>SwipeCardAsItem</state-name>
            <hold-weight />
            <push-hold-weight />
        </application-state>
        <application-state>
            <comment>This is GetFoodStamp state</comment>
            <state-name>GetFoodStamp</state-name>
            <hold-weight />
            <push-hold-weight />
        </application-state>
        <application-state>
            <state-name>ItemNotForSale</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
        </application-state>
        <application-state>
            <state-name>ItemQuantityExceeded</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
        </application-state>
        <application-state>
            <state-name>InsertCoupon</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
        </application-state>
        <application-state>
            <comment>This is PickingUpItems state</comment>
            <state-name>PickingUpItems</state-name>
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>picking_up_items_flag</value>
                        </parameter>
                        <parameter>
                            <value>1</value>
                        </parameter>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>IsItemRemovedAutoAdvanceEnabled</action-name>
                    </action>
                    <on-failure-action>
                        <action-name>stop-timer</action-name>
                        <parameter>
                            <value>delayed_timer</value>
                        </parameter>
                    </on-failure-action>
                </rule>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>item_removed_flag</value>
                        </parameter>
                        <parameter>
                            <value>0</value>
                        </parameter>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>SetPickingUpItemsTimeout</action-name>
                        <parameter>
                            <value>picking_up_items_timeout_value</value>
                        </parameter>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>start-timer</action-name>
                        <parameter>
                            <value>picking_up_items_timer</value>
                        </parameter>
                        <parameter>
                            <value>picking_up_items_timeout_value</value>
                        </parameter>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>stop-timer</action-name>
                        <parameter>
                            <value>delayed_timer</value>
                        </parameter>
                    </action>
                </rule>
            </entry-rule-list>
            <exit-rule-list>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>picking_up_items_flag</value>
                        </parameter>
                        <parameter>
                            <value>0</value>
                        </parameter>
                    </action>
                </rule>
            </exit-rule-list>
        </application-state>
        <application-state>
            <state-name>RAPDataNeeded</state-name>
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>NotifyTakeawayBelt</action-name>
                        <parameter>
                            <value>stop-belt</value>
                        </parameter>
                    </action>
                </rule>
            </entry-rule-list>
            <!--
            <exit-rule-list>
                <rule>
                    <action>
                        <action-name>NotifyTakeawayBelt</action-name>
                        <parameter>
                            <value>stable-good-weight</value>
                        </parameter>
                    </action>
                </rule>
            </exit-rule-list>
            -->
        </application-state>

	<!-- Remove lines ofr TAR 374645
        <application-state>
            <comment>This is RequestSig state</comment>
            <state-name>RequestSig</state-name>
            <hold-weight />
            <push-hold-weight />
        </application-state>
	-->
		<application-state>
		   <state-name>CardProcessing</state-name>
		   <hold-weight/>
		   <push-hold-weight/>
		</application-state>
		<application-state>
            <comment>This is CmDataEntry state</comment>
            <state-name>CmDataEntry</state-name>
            <hold-weight />
            <push-hold-weight />
        </application-state>
        <application-state>
            <comment>This is ScanAndBag state</comment>
            <state-name>ScanAndBag</state-name>
            <do-not-hold-weight />
            <entry-rule-list>
		<rule>
                    <action>
                        <action-name>send-msg</action-name>
                        <parameter>
                            <value>Enter Scan And Bag</value>
                        </parameter>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>scan_and_bag_flag</value>
                        </parameter>
                        <parameter>
                            <value>1</value>
                        </parameter>
                    </action>
                </rule>
            </entry-rule-list>
            <exit-rule-list>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>scan_and_bag_flag</value>
                        </parameter>
                        <parameter>
                            <value>0</value>
                        </parameter>
                    </action>
                </rule>
            </exit-rule-list>
        </application-state>
        <application-state>
            <state-name>SecBagAreaBackup</state-name>
            <takeaway-belt>handle-bag-area-backup</takeaway-belt>
            <push-hold-weight />
            <hold-weight />
        </application-state>
        <application-state>
            <state-name>SecMisMatchWeight</state-name>
            <takeaway-belt>stable-bad-weight</takeaway-belt>
<!--TAR291798 
           <exit-rule-list>
                <rule>
                    <action>
                        <action-name>NotifyTakeawayBelt</action-name>
                        <parameter>
                            <value>stable-good-weight</value>
                        </parameter>
                    </action>
                </rule>
            </exit-rule-list>
-->
        </application-state>
        <application-state>
            <state-name>SecNewItemEntry</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
            <hold-weight />
            <push-hold-weight />
        </application-state>
        <application-state>
            <comment>This is SecUnexpectedDecrease state</comment>
            <state-name>SecUnexpectedDecrease</state-name>
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>unexpected_decrease_flag</value>
                        </parameter>
                        <parameter>
                            <value>1</value>
                        </parameter>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>IsRemoveItemViolationAutoAdvanceEnabled</action-name>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>SetPickingUpItemsTimeout</action-name>
                        <parameter>
                            <value>unexpected_decrease_timeout_value</value>
                        </parameter>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>start-timer</action-name>
                        <parameter>
                            <value>unexpected_decrease_timer</value>
                        </parameter>
                        <parameter>
                            <value>unexpected_decrease_timeout_value</value>
                        </parameter>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>stop-timer</action-name>
                        <parameter>
                            <value>delayed_timer</value>
                        </parameter>
                    </action>
                </rule>
            </entry-rule-list>
            <exit-rule-list>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>unexpected_decrease_flag</value>
                        </parameter>
                        <parameter>
                            <value>0</value>
                        </parameter>
                    </action>
                </rule>
            </exit-rule-list>
        </application-state>
        <application-state>
            <state-name>SecUnExpectedIncrease</state-name>
            <takeaway-belt>stable-bad-weight</takeaway-belt>
        </application-state>
        <application-state>
            <comment>This is SmmAddWeight state</comment>
            <state-name>SmmAddWeight</state-name>
            <do-not-hold-weight />
            <push-hold-weight />
        </application-state>
        <application-state>
            <comment>This is SmAssistMode state</comment>
            <state-name>SmAssistMode</state-name>
            <takeaway-belt>start-assist-mode</takeaway-belt>
            <push-hold-weight />
            <hold-weight />
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>send-msg</action-name>
                        <parameter>
                            <value>Enter Assist Mode</value>
                        </parameter>
                    </action>
                </rule>
            </entry-rule-list>
            <exit-rule-list>
                <rule>
                    <action>
                        <action-name>send-msg</action-name>
                        <parameter>
                            <value>Exit Assist Mode</value>
                        </parameter>
                    </action>
                </rule>
                <!-- +TAB Issue 41 -->
                 <rule>
                    <action>
                        <action-name>SetLastGoodWeight</action-name>
                        <parameter>
                            <value>set-lgw</value>
                        </parameter>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>ResetSmartScaleTimers</action-name>
                        <parameter>
                            <value>all</value>
                        </parameter>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>CheckForExceptions</action-name>
                    </action>
                </rule>
                <!-- -TAB Issue 41 -->
            </exit-rule-list>
        </application-state>
        <application-state>
            <comment>This is SmRemoteAssistMode state</comment>
            <state-name>SmRemoteAssistMode</state-name>
            <takeaway-belt>start-assist-mode</takeaway-belt>
            <push-hold-weight />
            <hold-weight />
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>send-msg</action-name>
                        <parameter>
                            <value>Enter Remote Assist Mode</value>
                        </parameter>
                    </action>
                </rule>
            </entry-rule-list>
            <exit-rule-list>
                <rule>
                    <action>
                        <action-name>send-msg</action-name>
                        <parameter>
                            <value>Exit Remote Assist Mode</value>
                        </parameter>
                    </action>
                </rule>
<!--                
                <rule>
                    <action>
                        <action-name>ResetSmartScaleTimers</action-name>
                        <parameter>
                            <value>all</value>
                        </parameter>
                    </action>
                </rule>
-->                
                <rule>
                    <action>
                        <action-name>CheckForExceptions</action-name>
                    </action>
                </rule>
            </exit-rule-list>
        </application-state>
        <application-state>
            <comment>This is SmAuthorization state</comment>
            <state-name>SmAuthorization</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
            <hold-weight />
            <exit-rule-list>
                <rule>
                    <action>
                        <action-name>ClearHoldWeight</action-name>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>CheckForExceptions</action-name>
                    </action>
                       <on-failure-action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Set LGW From Authorization</value>
                            </parameter>
                        </on-failure-action>
                </rule>
            </exit-rule-list>
        </application-state>
        <application-state>
            <state-name>SmReportsMenu</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
        </application-state>
        <application-state>
            <state-name>Suspend</state-name>
            <push-hold-weight />
            <hold-weight />
        </application-state>
        <application-state>
            <state-name>SystemMessage</state-name>
            <hold-weight />
            <push-hold-weight />
        </application-state>
        <application-state>
            <state-name>SystemMessageOpPass</state-name>
            <hold-weight />
            <push-hold-weight />
        </application-state>
        <application-state>
            <state-name>TenderBalance</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
        </application-state>
        <application-state>
            <state-name>ThankYou</state-name>
            <do-not-hold-weight />
<!--            
In investigating 278124, we determined this rule allows weight on scale after
finish and pay.
-->
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>send-msg</action-name>
                        <parameter>
                            <value>Enter Thank You</value>
                        </parameter>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>SetLastGoodWeight</action-name>
                        <parameter>
                            <value>set-lgw-no-expectation</value>
                        </parameter>
                    </action>
                </rule>
            </entry-rule-list>
            <takeaway-belt>reset</takeaway-belt>            
        </application-state>
        <application-state>
            <state-name>TimeRestrictedItem</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
        </application-state>
        <application-state>
            <comment>This is TransportItem state</comment>
            <state-name>TransportItem</state-name>
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>transport_item_flag</value>
                        </parameter>
                        <parameter>
                            <value>1</value>
                        </parameter>
                    </action>
                </rule>
            </entry-rule-list>
            <exit-rule-list>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>transport_item_flag</value>
                        </parameter>
                        <parameter>
                            <value>0</value>
                        </parameter>
                    </action>
                </rule>
            </exit-rule-list>
        </application-state>
        <application-state>
            <state-name>UnDeActivatedItemApproval</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
            <push-hold-weight />
            <hold-weight />
            <exit-rule-list>
                <rule>
                    <action>
                        <action-name>NotifyTakeawayBelt</action-name>
                        <parameter>
                            <value>stable-good-weight</value>
                        </parameter>
                    </action>
                </rule>
            </exit-rule-list>
        </application-state>
        <application-state>
            <state-name>UnknownItem</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
        </application-state>
        <application-state>
            <state-name>VoidNoMatch</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
        </application-state>
        <application-state>
            <state-name>WaitForRemoteAssistance</state-name>
            <takeaway-belt>stop-belt</takeaway-belt>
            <hold-weight />
            <push-hold-weight />
        </application-state>
        <application-state>
            <comment>This is LaneClosed state</comment>
            <state-name>LaneClosed</state-name>
              <entry-rule-list>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>lane_closed_flag</value>
                        </parameter>
                        <parameter>
                            <value>1</value>
                        </parameter>
                    </action>
                </rule>
            </entry-rule-list>
            <exit-rule-list>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>lane_closed_flag</value>
                        </parameter>
                        <parameter>
                            <value>0</value>
                        </parameter>
                    </action>
                </rule>
            </exit-rule-list>
        </application-state>
        <application-state>
            <comment>This is MultiPick state</comment>
            <state-name>MultiPicklist</state-name>
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>multi_pick_flag</value>
                        </parameter>
                        <parameter>
                            <value>1</value>
                        </parameter>
                    </action>
				</rule>
            </entry-rule-list>            
             <exit-rule-list>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>multi_pick_flag</value>
                        </parameter>
                        <parameter>
                            <value>0</value>
                        </parameter>
                    </action>
				</rule>             
                <rule>
                    <action>
                        <action-name>SendItemPickFinish</action-name>
                    </action>
                </rule>
            </exit-rule-list>
        </application-state>
        <application-state>
            <comment>This is Degraded ContinueTrans state</comment>
            <state-name>DegradedContinueTrans</state-name>
            <do-not-hold-weight/>
        </application-state>
    </application-state-list>
    <!-- ============================================================================ -->
    <!-- Section:  Rules for state transitions                                        -->
    <!-- ============================================================================ -->
    <rules>
        <!-- ======================================================================== -->
        <!-- State:  Global                                                           -->
        <!-- Messages:  Initialize from FL to begin the initialization process        -->
        <!-- ======================================================================== -->
        <state>
            <global />
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>GlobalLog</action-name>
                        <parameter>
                            <value>Global Entry</value>
                        </parameter>
                    </action>
                </rule>
            </entry-rule-list>
            <exit-rule-list>
                <rule>
                    <action>
                        <action-name>GlobalLog</action-name>
                        <parameter>
                            <value>Global Exit</value>
                        </parameter>
                    </action>
                </rule>
            </exit-rule-list>
            <!--
            <message>
                <message-name>*</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>GlobalLog</action-name>
                            <parameter>
                                <value>Message Received</value>
                            </parameter>
                            <parameter>
                                <value>Parameter 2 Value</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
-->
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Any state                                                        -->
        <!-- Messages:  Initialize from FL to begin the initialization process        -->
        <!--                                                                          -->
        <!--                                                                          -->
        <!--      Message:                  Purpose:                                  -->
        <!--      _____________________     _________________________________________ -->
        <!--      Initialize                Begin the initialization process          -->
        <!--      Security Maintenance      Start SMM mode                            -->
        <!--      Transaction Control       FL requests an action regarding the xact  -->
        <!--      Transaction End           TC Internal - end the xact                -->
        <!--      Transaction Void          TC Internal - void the xact               -->
        <!--      Application Control       FL requests an action regarding the app   -->
        <!--      Set Application State     AC Internal - change the app state        -->
        <!--      Hold Weight Command       AC Internal - hold weight notifications   -->
        <!--      Resume Weight Command     AC Internal - resume weight notifications -->
        <!--      Security Control          FL requests an action affecting Sec.      -->
        <!--      Unmatched Wt              Scale reports an umatched weight          -->
        <!--      Unmatched Increase        Internal - increase detected on scale     -->
        <!--      Unmatched Decrease        Internal - decrease detected on scale     -->
        <!--      BackToLGW                 Scale reports a Back to LGW condition     -->
        <!--      Override Exception        FL requests an override of an exception   -->
        <!--      Clear Exception           Internal - clear the exception            -->
        <!--      Clear Exception With Update                                         -->
        <!--                                Internal - clear the exception; update    -->
        <!--                                WLDB                                      -->
        <!--      Device Failure            Internal - Smart Scale has reported error -->
        <!--      DB Mgr Status             Internal - DB Mgr Client has error        -->
        <!--      Clear Exception - All Immediate Wt Changes                          -->
        <!--                                FL requests to clear all immediate wt changes -->
        <!-- ======================================================================== -->
        <state>
            <state-name>*</state-name>
            <message>
                <message-name>Clear All Exceptions No Change State</message-name>
                <message-rule-list>
                    <rule>
                        <!-- This action will execute in the event that all exceptions
                            are being cleared,  i.e. the id was specified as '*' in
                            the KV -->
                        <action>
                            <action-name>ClearDelayedException</action-name>
                            <parameter>
                                <value>flags-clear-remove-exception</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Security Maintenance</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SecurityMaintenanceCommand</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Transaction Control</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>TransactionControlCommand</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
	    <message>
                <message-name>Enter Scan And Bag</message-name>
            </message>
			<message>
                <message-name>Enter Thank You</message-name>
            </message>
            <message>
                <message-name>Transaction End</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>CheckTransactionComplete</action-name>
                        </action>
                        <failure-transition>Complete</failure-transition>
                        <on-failure-action>
                            <action-name>SendSecurityViolations</action-name>
                        </on-failure-action>
                    </rule>
                    <success-transition>Complete</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Transaction Void Begin</message-name>
                <message-rule-list>
                    <success-transition>Transaction Voided</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Takeaway Belt Data Event</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>TakeawayBeltStatus</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Takeaway Belt - Ready</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>ReadyTABForNextItem</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendTABStatus</action-name>
                            <parameter>
                                <value>enable-scanner</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Takeaway Belt - Not Ready</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SendTABStatus</action-name>
                            <parameter>
                                <value>disable-scanner</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Takeaway Belt - Scale Status Requested</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SendScaleStatusToTAB</action-name>
                            <parameter>
                                <value>transport_item_flag</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Takeaway Belt - Cover Open</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stop-belt</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>HandleTABCover</action-name>
                            <parameter>
                                <value>open</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Takeaway Belt - Cover Closed</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>HandleTABCover</action-name>
                            <parameter>
                                <value>closed</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Takeaway Belt - Bag Area Clear</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SendTABStatus</action-name>
                            <parameter>
                                <value>bag-area-clear</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Takeaway Belt - Bag Area Backup</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SendTABStatus</action-name>
                            <parameter>
                                <value>bag-area-backup</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Takeaway Belt - Assist Mode Done</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SendTABStatus</action-name>
                            <parameter>
                                <value>stop-assist-mode-complete</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Takeaway Belt - Item Moved Off Belt1</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>decrement-variable</action-name>
                            <parameter>
                                <value>belt_item_count</value>
                            </parameter>
                        </action>
                    </rule>
<!-- TAR 276877
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                            <parameter>
                                <value>set-beginning-lgw</value>
                            </parameter>
                        </action>
                    </rule>
-->
                </message-rule-list>
            </message>
            <message>
                <message-name>Application Control</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>ApplicationControlCommand</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <!-- This is an application control message used to inform security
                    of a state change within the application -->
                <message-name>Set Application State</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SetApplicationStateCommandTAB</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <!-- This is an application control message used to tell
                    security to suppress sending weight messages -->
                <message-name>Hold Weight Command</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SetHoldWeight</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <!-- This is an application control message used to tell
                    security to resume sending weight messages -->
                <message-name>Resume Weight Command</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>ClearHoldWeight</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Security Control</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SecurityControlCommandTAB</action-name>
                            <parameter>
                                <value>security_control_command_type</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- SecurityControl operation=get -->
                    <rule>
                        <action>
                            <action-name>evaluate-expression</action-name>
                            <parameter>
                                <value>security_control_command_type!=1</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>GetCommand</action-name>
                        </on-failure-action>
                    </rule>
                    <!-- SecurityControl operation=set -->
                    <rule>
                        <action>
                            <action-name>evaluate-expression</action-name>
                            <parameter>
                                <value>security_control_command_type!=2</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>SetCommand</action-name>
                        </on-failure-action>
                    </rule>
                    <!-- SecurityControl operation=reload-options -->
                    <rule>
                        <action>
                            <action-name>evaluate-expression</action-name>
                            <parameter>
                                <value>security_control_command_type!=3</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>ReloadConfiguration</action-name>
                        </on-failure-action>
                    </rule>
                    <!-- SecurityControl operation=serialize -->
                    <rule>
                        <action>
                            <action-name>evaluate-expression</action-name>
                            <parameter>
                                <value>security_control_command_type!=4</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>SerializeCommand</action-name>
                        </on-failure-action>
                    </rule>
                    <!-- SecurityControl operation=abort -->
                    <rule>
                        <action>
                            <action-name>evaluate-expression</action-name>
                            <parameter>
                                <value>security_control_command_type!=5</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>AbortCommand</action-name>
                        </on-failure-action>
                    </rule>
                    <!-- SecurityControl operation=query-device-status -->
                    <rule>
                        <action>
                            <action-name>evaluate-expression</action-name>
                            <parameter>
                                <value>security_control_command_type!=6</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>QueryDeviceStatusCommand</action-name>
                        </on-failure-action>
                    </rule>
                    <!-- SecurityControl operation=assist-mode-stop -->
                    <rule>
                        <action>
                            <action-name>evaluate-expression</action-name>
                            <parameter>
                                <value>security_control_command_type!=1001</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stop-assist-mode</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <!-- SecurityControl operation=suspend-item -->
                    <rule>
                        <action>
                            <action-name>evaluate-expression</action-name>
                            <parameter>
                                <value>security_control_command_type!=1002</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stop-belt</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <!-- SecurityControl operation=flush-item -->
                    <rule>
                        <action>
                            <action-name>evaluate-expression</action-name>
                            <parameter>
                                <value>security_control_command_type!=1003</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Flush Item</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                </message-rule-list>
            </message>
            <!-- When this message is received, we are assuming that the
                TAB has been stopped previously.  Otherwise, the TAB state
                machine is in the wrong state to accept the following commands
                (should be in the WrongItemStop or WrongItemStopBelt2 states) -->
            <message>
                <message-name>Flush Item</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>CheckScaleNotEmpty</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>skip-bagging</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <!-- VoidItem API generated message -->
            <message>
                <message-name>Item Void</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>VoidItemCommand</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Unmatched Wt</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>HandleTABUnmatchedWt</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Unmatched Increase</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>HandleShuffle</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>HandleTABUnmatchedIncrease</action-name>
                            <parameter>
                                <value>scan_and_bag_flag</value>
                            </parameter>
                            <parameter>
                                <value>bag_and_eas_flag</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-bad-weight</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                    	<action>
                        	<action-name>send-msg</action-name>
                        	<parameter>
                            		<value>BackToLGW</value>
                        	</parameter>
                    	</action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Unmatched Decrease</message-name>
                <message-rule-list>
                    <!-- If this decrease is a late correction, then ignore 
                        NOTE:  not required for TAB
                    <rule>
                        <action>
                            <action-name>HandleUnmatchedIncreaseLateCorrection</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SetLastGoodWeight</action-name>
                        </on-failure-action>
                    </rule>
                    -->
                    <!-- Validate this decrease -->
                    <rule>
                        <action>
                            <action-name>HandleTABUnmatchedDecrease</action-name>
                            <parameter>
                                <value>scan_and_bag_flag</value>
                            </parameter>
                            <parameter>
                                <value>bag_and_eas_flag</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>BackToLGW</message-name>
                <message-rule-list>
                    <!-- The customer corrected the problem.  In case app
                        entered PickingUpItems state, ensure that the flag
                        is not zero.  This will turn off the auto advance -->
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>item_removed_flag</value>
                            </parameter>
                            <parameter>
                                <value>1</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>stop-timer</action-name>
                            <parameter>
                                <value>delayed_timer</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- +TAR 277210 -->
                    <rule>
                        <action>
                            <action-name>stop-timer</action-name>
                            <parameter>
                                <value>forgiveness_timer</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- -TAR 277210 -->
                    <rule>
                        <action>
                            <action-name>stop-timer</action-name>
                            <parameter>
                                <value>unexpected_decrease_timer</value>
                            </parameter>
                        </action>
                    </rule>
<!-- +TAB PERFORMANCE -->                    
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>scale-reads-zero</value>
                            </parameter>
                        </action>
                    </rule>
<!-- -TAB PERFORMANCE -->              
                    <!-- +TAR 276869 (TAB Issue 42) Belt does not reverse on second mismatch -->
<!-- TAR291963
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </action>
                    </rule>
-->
                    <!-- -TAR 276869 (TAB Issue 42) -->
                    <rule>
                        <action>
                            <action-name>ResetWeight</action-name>
                        </action>
                    </rule>

                    <!-- This action checks to see if the current exception is delayed.
                         If so, then action will return a FALSE to break the chain -->
                    <rule>
                        <action>
                            <action-name>IsCurrentExceptionDelayed</action-name>
                        </action>
                        <on-failure-action>
							<action-name>ClearLastWtException</action-name>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>CheckForExceptions</action-name>
                        </action>
                    </rule>
                    <!-- TAB Issue 36 - Do not want to clear all wt exceptions, only
                        last outstanding wt exception. -->
                    <!-- TAR 277066 - Added parameter to action so that we do not
                        mistakenly tell SCOTAPP that RAP cleared this exception -->
                    <rule>
                        <action>
                            <action-name>ClearLastWtException</action-name>
                        </action>
                    </rule>
                    <!-- TAR 277282
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                            <parameter>
                                <value>set-beginning-lgw</value>
                            </parameter>
                        </action>
                    </rule>
-->
                </message-rule-list>
            </message>
            <!-- TAR 287854 -->
            <message>
                <message-name>Clear Exception - All Immediate Wt Changes</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>ClearAllImmediateWtChanges</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>            
            <message>
                <message-name>Override Exception</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>OverrideExceptionCommand</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Clear Exception</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                    <!-- TAB Issue 30 advance belts after exception cleared -->
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <!-- This action will clear a single exception as indicated by
                            the id field in the message. -->
                        <action>
                            <action-name>ClearException</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Clear Exception - All Wt Changes</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <!-- This action will clear a single exception as indicated by
                            the id field in the message. -->
                        <action>
                            <action-name>ClearException</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Clear All Exceptions</message-name>
                <message-rule-list>
                    <rule>
                        <!-- This action will execute in the event that all exceptions
                            are being cleared,  i.e. the id was specified as '*' in
                            the KV -->
                        <action>
                            <action-name>ClearAllExceptions</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Throw Exception</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SetForgivenessTimeout</action-name>
                            <parameter>
                                <value>forgiveness_timeout_value</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- This action checks to see if it can be forgiven.  If so,
                         then action will return a FALSE to break the chain -->
                    <rule>
                        <action>
                            <action-name>IsExceptionForgiven</action-name>
                            <parameter>
                                <value>finalize_flag</value>
                            </parameter>
                            <parameter>
                                <value>bag_and_eas_flag</value>
                            </parameter>
                            <parameter>
                                <value>scan_and_bag_flag</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>start-timer</action-name>
                            <parameter>
                                <value>forgiveness_timer</value>
                            </parameter>
                            <parameter>
                                <value>forgiveness_timeout_value</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>IsExceptionInterventionReq</action-name>
                            <parameter>
                                <value>scan_and_bag_flag</value>
                            </parameter>
                            <parameter>
                                <value>bag_and_eas_flag</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetDelayedTimeout</action-name>
                            <parameter>
                                <value>delayed_timeout_value</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- This action checks to see if the exception can be delayed.
                         If so, then action will return a FALSE to break the chain -->
                    <rule>
                        <action>
                            <action-name>IsExceptionDelayed</action-name>
                            <parameter>
                                <value>not_finalize_flag</value>
                            </parameter>
                            <parameter>
                                <value>not_complete_flag</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>start-timer</action-name>
                            <parameter>
                                <value>delayed_timer</value>
                            </parameter>
                            <parameter>
                                <value>delayed_timeout_value</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <!-- We made all checks and now must go ahead and send the
                         exception on to the application for processing -->
                    <rule>
                        <action>
                            <action-name>ThrowException</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>forgiveness_timer_timeout</message-name>
                <message-rule-list>
                    <!-- +TAR 277282 (TAB Issue 29) advance belts after forgiveness 
                        Must send item-scan first to force TAB into proper state to
                        accept the stable-good-weight following -->
                    <!--
		    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>item-scan</value>
                            </parameter>
                        </action>
                    </rule> -->
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- -TAR 277282 (TAB Issue 29) -->
                    <rule>
                        <action>
                            <action-name>ClearForgivenException</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                    <!-- The following action will check to see if an item is
                        outstanding.  If so , then it will send an OnItemOK
                        event to the application -->
                    <!--
                    <rule>
                        <action>
                            <action-name>SendItemOK</action-name>
			    <parameter>
                                <value>send-item-ok</value>
                            </parameter>
                        </action>
                    </rule>
-->
                </message-rule-list>
            </message>
            <message>
                <message-name>delayed_timer_timeout</message-name>
                <message-rule-list>
                    <!-- +TAR 277282 (TAB Issue 29) advance belts after delayed cleared. 
                        Must send item-scan first to force TAB into proper state to
                        accept the stable-good-weight following -->
		    <!-- <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>item-scan</value>
                            </parameter>
                        </action>
                    </rule> -->
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- -TAR 277282 (TAB Issue 29) -->
                    <rule>
                        <action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Clear Delayed Exception</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Clear Delayed Exception</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>ClearDelayedException</action-name>
							<parameter>
								<value>flags-clear-report-only</value>
							</parameter>
                        </action>
                    </rule>
                    <!-- TAB Issue 31 advance belts after exception cleared -->
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                    <!-- The following action will check to see if an item is
                        outstanding.  If so , then it will send an OnItemOK
                        event to the application -->
                    <!--
                    <rule>
                        <action>
                            <action-name>SendItemOK</action-name>
			    <parameter>
                                <value>send-item-ok</value>
                            </parameter>
                        </action>
                    </rule>
-->
                </message-rule-list>
            </message>
            <message>
                <message-name>Item Details</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stop-belt</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Item Validated</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                    <rule>
						<action>
                            <action-name>evaluate-expression</action-name>
                            <parameter>
                                <value>skip_bagging_in_multi_pick_flag==0</value>
                            </parameter>
						</action>
                        <on-failure-action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Item Validated Not Send Item OK</value>
                            </parameter>                        			
						</on-failure-action>
                    </rule> 
                    <!-- The following action will check to see if an item is
                        outstanding.  If so , then it will send an OnItemOK
                        event to the application -->
                    <rule>
                        <action>
                            <action-name>SendItemOK</action-name>
			    <parameter>
                                <value>send-item-ok</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>increment-variable</action-name>
                            <parameter>
                                <value>ItemCounter</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Item Validated Not Send Item OK</message-name>
                <message-rule-list>                
                    <rule>
                        <action>
                            <action-name>CheckSkipBagging</action-name>
							<parameter>
								<value>not-check-skip-bagging-threshold</value>
							</parameter>                            
                        </action>
                    </rule>                                      
                    <!-- This message is for item in Multi Pick mode only, just validate the item and DO NOT SEND ITEMOK MESSAGE TO FL -->
                    <rule>
                        <action>
                            <action-name>SendItemOK</action-name>
			    <parameter>
                                <value>not-send-item-ok</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                    	<action>
                            <action-name>assign-variable</action-name>
                        	<parameter>
                            		<value>skip_bagging_in_multi_pick_flag</value>
                        	</parameter>
                        	<parameter>
                            		<value>0</value>
                        	</parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>increment-variable</action-name>
                            <parameter>
                                <value>ItemCounter</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Abort</message-name>
                <message-rule-list>
                    <!-- +TAR 277497 Ensure that belt stops before unloading -->
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>reset</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- -TAR 277497 -->
                    <rule>
                        <action>
                            <action-name>UnloadTakeawayBelt</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>UnloadDBMgrClient</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>UnloadSmartScale</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>UnloadWTInfo</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>UnloadConfiguration</action-name>
                        </action>
                    </rule>
                    <success-transition>Uninitialized</success-transition>
                </message-rule-list>
            </message>
            <!-- This message is received when the item removed button is
                pressed -->
            <message>
                <message-name>Item Removed</message-name>
                <message-rule-list>
                    <!-- The customer pressed the item removed button in
                        PickingUpItems state.  Ensure that the flag
                        is not zero.  This will turn off the auto advance -->
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>item_removed_flag</value>
                            </parameter>
                            <parameter>
                                <value>1</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- Always need to set last good weight when item removed
                        button is pressed. -->
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                            <parameter>
                                <value>last-exception-weight</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- Check to see if the threshold has been passed -->
                    <rule>
                        <action>
                            <action-name>CheckItemRemoved</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <!-- This message is received if the application has entered
                the PickingUpItems state but the button has not been
                pressed. -->
            <message>
                <message-name>picking_up_items_timer_timeout</message-name>
                <message-rule-list>
                    <!-- Returns false if auto advance is not in effect -->
                    <rule>
                        <action>
                            <action-name>CheckItemRemovedAutoAdvance</action-name>
                            <parameter>
                                <value>item_removed_flag</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>item_removed_flag</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>unexpected_decrease_timer_timeout</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>CheckSkipBagging</action-name>
							<parameter>
								<value>check-skip-bagging-threshold</value>
							</parameter>                                                        
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>unexpected_decrease_flag</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Device Failure</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>HandleSmartScaleFailure</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>DB Mgr Status</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>HandleSmartScaleFailure</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <!-- Ignore this timeout because we are using the wait-timer action 
                instead to block the thread from returing until timeout received -->
            <message>
                <message-name>scale_initialization_timer_timeout</message-name>
            </message>
            <message>
                <message-name>Enter Assist Mode</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>push-state</action-name>
                        </action>
                    </rule>
                    <success-transition>Assist Mode</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Enter Remote Assist Mode</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>push-state</action-name>
                        </action>
                    </rule>
                    <success-transition>Remote Assist Mode</success-transition>
                </message-rule-list>
            </message>
	    <!-- Clear Weight When there is no exception -->
            <message>
                <message-name>Set LGW From Authorization</message-name>
                <message-rule-list>
                     <rule>
                     	<action>
                            <action-name>SetBeginningTransLGW</action-name>
                        <parameter>
                            <value>set-beginningtranslgw-storemode</value>
                        </parameter>
                     </action>
                </rule>
<!-- +TAB Issue 41 -->                
                <rule>
                    <action>
                        <action-name>SetLastGoodWeight</action-name>
                        <parameter>
                            <value>set-lgw</value>
                        </parameter>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>ResetSmartScaleTimers</action-name>
                        <parameter>
                            <value>all</value>
                        </parameter>
                    </action>
                </rule>                
	    	</message-rule-list>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Uninitialized                                                      -->
        <!-- Messages:  Initialize from FL to begin the initialization process        -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Uninitialized</state-name>
            <message>
                <message-name>Initialize</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SaveInitializeParameters</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>LoadConfiguration</action-name>
                        </action>
                    </rule>
                    <success-transition>InitPhase1</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Takeaway Belt Data Event</message-name>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  InitPhase1                                                       -->
        <!-- Messages:  Initialize from FL to begin the initialization process        -->
        <!-- ======================================================================== -->
        <state>
            <state-name>InitPhase1</state-name>
            <message>
                <message-name>Initialize</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>LoadWTInfo</action-name>
                        </action>
                    </rule>
                    <success-transition>InitPhase2</success-transition>
                </message-rule-list>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  InitPhase2                                                       -->
        <!-- Messages:  Initialize from FL to begin the initialization process        -->
        <!-- ======================================================================== -->
        <state>
            <state-name>InitPhase2</state-name>
            <message>
                <message-name>Initialize</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>LoadSmartScaleTAB</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetHoldWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetScaleInitializationTimeout</action-name>
                            <parameter>
                                <value>scale_initialization_timeout_value</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>start-timer</action-name>
                            <parameter>
                                <value>scale_initialization_timer</value>
                            </parameter>
                            <parameter>
                                <value>scale_initialization_timeout_value</value>
                            </parameter>
                        </action>
                    </rule>
                    <success-transition>InitPhase3</success-transition>
                </message-rule-list>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  InitPhase3                                                       -->
        <!-- Messages:  Initialize from FL to begin the initialization process        -->
        <!-- ======================================================================== -->
        <state>
            <state-name>InitPhase3</state-name>
            <message>
                <message-name>Initialize</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>LoadDBMgrClient</action-name>
                        </action>
                    </rule>
                    <success-transition>InitPhase4</success-transition>
                </message-rule-list>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  InitPhase3                                                       -->
        <!-- Messages:  Initialize from FL to begin the initialization process        -->
        <!-- ======================================================================== -->
        <state>
            <state-name>InitPhase4</state-name>
            <message>
                <message-name>Initialize</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>LoadTakeawayBelt</action-name>
                        </action>
                    </rule>
                    <success-transition>InitPhase5</success-transition>
                </message-rule-list>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  InitPhase4                                                       -->
        <!-- Messages:  Initialize from FL to begin the initialization process        -->
        <!-- ======================================================================== -->
        <state>
            <state-name>InitPhase5</state-name>
            <message>
                <message-name>Initialize</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>wait-timer</action-name>
                            <parameter>
                                <value>scale_initialization_timer</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetBeginningTransLGW</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>InitializationComplete</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>FlushTABInAttract</action-name>
                        </action>
                    </rule>
                    <success-transition>Idle</success-transition>
                </message-rule-list>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Idle                                                             -->
        <!-- Function:  Main state for handling items                                 -->
        <!-- Messages:                                                                -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Idle</state-name>
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>ClearHoldWeight</action-name>
                    </action>
                </rule>
            </entry-rule-list>
<!-- TAR458896 -->
            <message>
                <message-name>BackToLGW</message-name>
                <message-rule-list>
                    <!-- The customer corrected the problem.  In case app
                        entered PickingUpItems state, ensure that the flag
                        is not zero.  This will turn off the auto advance -->
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>item_removed_flag</value>
                            </parameter>
                            <parameter>
                                <value>1</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>stop-timer</action-name>
                            <parameter>
                                <value>delayed_timer</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- +TAR 277210 -->
                    <rule>
                        <action>
                            <action-name>stop-timer</action-name>
                            <parameter>
                                <value>forgiveness_timer</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- -TAR 277210 -->
                    <rule>
                        <action>
                            <action-name>stop-timer</action-name>
                            <parameter>
                                <value>unexpected_decrease_timer</value>
                            </parameter>
                        </action>
                    </rule>
<!-- +TAB PERFORMANCE -->                    
<!-- 461483 -->
                    <rule>
                        <action>
                            <action-name>evaluate-expression</action-name>
                            <parameter>
                                <value>belt_item_count==0</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>send-msg</action-name>
                	        <parameter>
                        	    <value>BackToLGW Clear All</value>
	                        </parameter>
                        </on-failure-action>
                    </rule> 
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>scale-reads-zero</value>
                            </parameter>
                        </action>
                    </rule>
<!-- -TAB PERFORMANCE -->              
                    <rule>
                        <action>
                            <action-name>ResetWeight</action-name>
                        </action>
                    </rule>
                    <!-- +TAR458896 --> 
                    <rule>
                        <action>
                            <action-name>SendTransactionComplete</action-name>
                        </action>
                    </rule>
                    <!-- -TAR458896 --> 
                    <!-- This action checks to see if the current exception is delayed.
                         If so, then action will return a FALSE to break the chain -->
                    <rule>
                        <action>
                            <action-name>IsCurrentExceptionDelayed</action-name>
                        </action>
                        <on-failure-action>
							<action-name>ClearLastWtException</action-name>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>CheckForExceptions</action-name>
                        </action>
                    </rule>
                    <!-- TAB Issue 36 - Do not want to clear all wt exceptions, only
                        last outstanding wt exception. -->
                    <!-- TAR 277066 - Added parameter to action so that we do not
                        mistakenly tell SCOTAPP that RAP cleared this exception -->
                    <rule>
                        <action>
                            <action-name>ClearLastWtException</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
<!-- e TAR458896 -->

            <message>
                <message-name>Unmatched Increase</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>CheckRememberVirtualZero</action-name>
                            <parameter>
                                <value>virtual-zero-increase</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>HandleTABUnmatchedIncrease</action-name>
                        </action>
                        <on-failure-action>
                               <action-name>send-msg</action-name>
                                <parameter>
                                     <value>Bad Weight At Attract</value>
                                </parameter>
                          </on-failure-action>
                    </rule>
                   </message-rule-list>
            </message>


	    <message>
                <message-name>Bad Weight At Attract</message-name>
                <message-rule-list>
                    <rule>
                          <action>
                          <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-bad-weight</value>
                            </parameter>
                           </action>
                     </rule>
                     <rule>
                        <action>
                            <action-name>SendObservedWeight</action-name>
                        </action>
                    </rule>
                   </message-rule-list>
            </message>



            <message>
                <message-name>Clear Exception</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetBeginningTransLGW</action-name>
                            <parameter>
                                <value>set-beginningtranslgw-attract</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <!-- This action will clear a single exception as indicated by
                            the id field in the message. -->
                        <action>
                            <action-name>ClearException</action-name>
                        </action>
                    </rule>
                    <!-- +TAR 276871 -->
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- -TAR 276871 -->
                </message-rule-list>
            </message>
            <message>
                <message-name>Unmatched Decrease</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>CheckScaleNotEmpty</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>HandleTABUnmatchedDecrease</action-name>
                            <parameter>
                                <value>scan_and_bag_flag</value>
                            </parameter>
                            <parameter>
                                <value>bag_and_eas_flag</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>CheckRememberVirtualZero</action-name>
                            <parameter>
                                <value>virtual-zero-decrease</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetBeginningTransLGW</action-name>
                            <parameter>
                                <value>set-beginningtranslgw-attract</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>CheckForExceptions</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ClearAllWtExceptions</action-name>
                        </action>
                    </rule>		                        
                </message-rule-list>
            </message>
            <message>
                <message-name>quiet_mode_timer_timeout</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>attract_quiet_mode_timeout_value</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>attract_quiet_mode_violation</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetBeginningTransLGW</action-name>
                            <parameter>
                                <value>set-beginningtranslgw-attract</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Bag Box Button Pressed</message-name>
                <message-rule-list>
                    <!-- CheckBagBox ensures that the threshold has not been
                        reached.  If it has, then it will generate an exception and
                        return a false to end the chain -->
                    <rule>
                        <action>
                            <action-name>CheckBagBox</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Transaction Begin</message-name>
                <message-rule-list>
                    <!-- TAR 276416                    
                    <rule>
                        <action>
                            <action-name>CheckQuietModeAttract</action-name>
                            <parameter>
                                <value>attract_quiet_mode_timeout_value</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>StartTransaction</action-name>
                        </on-failure-action>
                        <failure-transition>Start</failure-transition>
                    </rule>
                    <rule>
                        <action>
                            <action-name>CheckQuietModeViolation</action-name>
                        </action>
                    </rule>
-->
                    <rule>
                        <action>
                            <action-name>StartTransaction</action-name>
                        </action>
                    </rule>
                    <!-- +TAR 276871 -->
                    <rule>
                        <action>
                            <action-name>SetBeginningTransLGW</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>CheckForExceptions</action-name>
                        </action>
                        <failure-transition>Start</failure-transition>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                    <!-- -TAR 276871 -->
                    <success-transition>Start</success-transition>
                </message-rule-list>
            </message>
            <!-- +TAR287456 -->
            <message>
                <message-name>Transaction Continue</message-name>
                <message-rule-list>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <!-- -TAR287456 -->
	    <message>
                <message-name>Enter Scan And Bag</message-name>
                <message-rule-list>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM Begin</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>push-state</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SMMBegin</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                        <failure-transition>Security Maintenance</failure-transition>
                    </rule>
                    <success-transition>Security Maintenance</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Transaction Finalize</message-name>
                <message-rule-list>
                    <success-transition>Finalize</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Takeaway Belt - Bag Area Backup</message-name>
            </message>
            <!-- This way when we exit assist mode, we will pop back into Start instead of Idle
                 Since Idle state cannot properly handle a transaction ending -->
            <message>
                <message-name>Enter Remote Assist Mode</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>resend-msg</action-name>
                        </action>
                    </rule>                
                    <success-transition>Start</success-transition>
                </message-rule-list>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Start                                                            -->
        <!-- Function:  Main state for handling items                                 -->
        <!-- Messages:                                                                -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Start</state-name>
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>belt_item_count</value>
                        </parameter>
                        <parameter>
                            <value>0</value>
                        </parameter>
                    </action>
                </rule>
            </entry-rule-list>
            <message>
                <message-name>Item Sold</message-name>
                <message-rule-list>
					<!-- 407200 - -->
                    <rule>
                    	<action>
                            <action-name>assign-variable</action-name>
                        	<parameter>
                            		<value>skip_bagging_in_multi_pick_flag</value>
                        	</parameter>
                        	<parameter>
                            		<value>0</value>
                        	</parameter>
                         </action>
					</rule>           
					<!-- 407200 - -->                     
                    <rule>
                        <action>
                            <action-name>ResetAtItemScanForTAB</action-name>
                        </action>
                    </rule>
                    <!-- Always need to set the hold weight -->
                    <rule>
                        <action>
                            <action-name>SetHoldWeight</action-name>
                        </action>
                    </rule>
	            <rule>
                        <action>
                            <action-name>increment-variable</action-name>
                            <parameter>
                                <value>belt_item_count</value>
                            </parameter>
                        </action>
                    </rule>
                     <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>item-scan</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- AddItemToTransaction returns false if the item was not
                        scanned (i.e. keyed or picklist) -->
                    <rule>
                        <action>
                            <action-name>AddItemToTransaction</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>ItemNotScannedAdjustment</action-name>
                        </on-failure-action>
                        <failure-transition>Wait DB</failure-transition>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendDBRequest</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>start-timer</action-name>
                            <parameter>
                                <value>db_lookup_timer</value>
                            </parameter>
                            <parameter>
                                <value>1000</value>
                            </parameter>
                        </action>
                    </rule>
                    <success-transition>Wait DB</success-transition>
                </message-rule-list>
            </message>
            <!-- This message is received when the Bag Box button is
                pressed -->
            <message>
                <message-name>Bag Box Button Pressed</message-name>
                <message-rule-list>
                    <!-- CheckBagBox ensures that the threshold has not been
                        reached.  If it has, then it will generate an exception and
                        return a false to end the chain -->
                    <rule>
                        <action>
                            <action-name>CheckBagBox</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM Begin</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>push-state</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SMMBegin</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                        <failure-transition>Security Maintenance</failure-transition>
                    </rule>
                    <success-transition>Security Maintenance</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Clear Exception</message-name>
                <message-rule-list>
                    <!-- This action will clear a single exception as indicated by
                        the id field in the message. -->
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                    <!-- Let TAB know that we now have an approved wt on the scale -->
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>evaluate-expression</action-name>
                            <parameter>
                                <value>attract_quiet_mode_violation!=0</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>ClearException</action-name>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>attract_quiet_mode_violation</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetBeginningTransLGW</action-name>
                            <parameter>
                                <value>set-beginningtranslgw-attract</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ClearException</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>delayed_timer_timeout</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>evaluate-expression</action-name>
                            <parameter>
                                <value>attract_quiet_mode_violation!=0</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Clear Delayed Exception</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>attract_quiet_mode_violation</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetBeginningTransLGW</action-name>
                            <parameter>
                                <value>set-beginningtranslgw-attract</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Clear Delayed Exception</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Transaction Finalize</message-name>
                <message-rule-list>
                    <success-transition>Finalize</success-transition>
                </message-rule-list>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Wait DB                                                          -->
        <!-- Function:  Database request has been sent and we are awaiting a response -->
        <!-- Messages:                                                                -->
        <!--      DB Response                                                         -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Wait DB</state-name>
            <message>
                <message-name>DB Response</message-name>
                <message-rule-list>
                    <!-- CheckDBResponse returns False if the department details have not
                         been received.  -->
                    <rule>
                        <action>
                            <action-name>CheckDBResponse</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>stop-timer</action-name>
                            <parameter>
                                <value>db_lookup_timer</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendWtRequestToScale</action-name>
                        </action>
                    </rule>
               <!-- <rule>
                        <action>
                            <action-name>increment-variable</action-name>
                            <parameter>
                                <value>belt_item_count</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>item-scan</value>
                            </parameter>
                        </action>
                    </rule> -->
                    <rule>
                        <action>
                            <action-name>ClearHoldWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>stop-timer</action-name>
                            <parameter>
                                <value>db_lookup_timer</value>
                            </parameter>
                        </action>
                        <failure-transition>Wait Scale</failure-transition>
                    </rule>
                    <success-transition>Wait Scale</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>db_lookup_timer_timeout</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>GlobalLog</action-name>
                            <parameter>
                                <value>db_lookup_timer timeout received</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendLastChanceLookupDBRequest</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Item Details</message-name>
                <message-rule-list>
                    <!-- This message is received from the application
                    when TB has finished selling the item.  The following
                    action will fail if the item is not marked as sellable -->
                    <rule>
                        <action>
                            <action-name>CheckItemDetails</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Item Not Sellable</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>CheckTABQuantityItem</action-name>
                        </action>
                    </rule>
                    <!-- Keyed items come here to bypass the dept
                        exceptions processing. -->
                    <rule>
                        <action>
                            <action-name>SendWtRequestToScale</action-name>
                        </action>
                    </rule>
                   <!-- <rule>
                        <action>
                            <action-name>increment-variable</action-name>
                            <parameter>
                                <value>belt_item_count</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>item-scan</value>
                            </parameter>
                        </action>
                    </rule> -->
                    <rule>
                        <action>
                            <action-name>ClearHoldWeight</action-name>
                        </action>
                    </rule>
                    <success-transition>Wait Scale</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Item Not Sellable</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stop-belt</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ClearHoldWeight</action-name>
                        </action>
                    </rule>
					<rule>
                        <action>
                            <action-name>SendGoToScanAndBag</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>IsTransactionEmpty</action-name>
                        </action>
                        <failure-transition>Item Entry</failure-transition>
                    </rule>
                    <success-transition>Start</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Dept Details</message-name>
                <message-rule-list>
                    <!-- CheckDeptDetails returns False if the database response has not
                         been received.  -->
                    <rule>
                        <action>
                            <action-name>CheckDeptDetails</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendWtRequestToScale</action-name>
                        </action>
                    </rule>  
	       <!-- <rule>
                        <action>
                            <action-name>increment-variable</action-name>
                            <parameter>
                                <value>belt_item_count</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>item-scan</value>
                            </parameter>
                        </action>
                    </rule> -->
                    <rule>
                        <action>
                            <action-name>ClearHoldWeight</action-name>
                        </action>
                    </rule>
                    <success-transition>Wait Scale</success-transition>
                </message-rule-list>
            </message>
	    <!-- TAR320897+ -->
            <message>
                <message-name>Skip Bagging</message-name>
                <message-rule-list>
<!-- +TAR 413591 Notify TAB -->
                   <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>skip-bagging</value>
                            </parameter>
                        </action>
                    </rule>
<!-- +TAR 278015 Forces TAB from UnpurchasedItemStopBelt2 to TestForScan -->                    
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>scale-reads-zero</value>
                            </parameter>
                        </action>
                    </rule>
<!-- -TAR 278015 -->                    
<!-- -TAR 413591 -->  
                    <rule>
			<action>
                            <action-name>evaluate-expression</action-name>
                            <parameter>
                                <value>unexpected_decrease_flag!=0</value>
                            </parameter>
			</action>
                        <on-failure-action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Skip Bagging2</value>
                            </parameter>
                        </on-failure-action>
                    </rule>                                    
                    <!-- CheckSkipBagging ensures that the threshold has not been
                        reached.  If it has, then it will generate an exception and
                        return a false to end the chain -->
                    <rule>
                        <action>
                            <action-name>CheckSkipBagging</action-name>
							<parameter>
								<value>check-skip-bagging-threshold</value>
							</parameter>                                                        
                        </action>
                        <!-- This action will execute in the event that the skip bagging
                            threshold has been exceeded. -->
                        <on-failure-action>
                            <action-name>SetLastGoodWeight</action-name>
                            <parameter>
                                <value>set-lgw</value>
                            </parameter>
                        </on-failure-action>
                        <failure-transition>Wait Scale - Skip Bagging Pressed</failure-transition>                        
                    </rule>
                    <!-- This rule will "call" a set of rules in the Any section.  These
                         rules are common to handling a valid item -->
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>              
            <message>
                <message-name>Skip Bagging2</message-name>
                <message-rule-list>
                    <rule>
						<action>
                            <action-name>evaluate-expression</action-name>
                            <parameter>
                                <value>multi_pick_flag==0</value>
                            </parameter>
						</action>
                        <on-failure-action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Skip Bagging3</value>
                            </parameter>
                        </on-failure-action>
                    </rule>                
                    <!-- IsNoWtInterventionOutstanding will cause the SkipBagging to be
                        ignored if there is an existing oustanding intervention -->
                    <rule>
                        <action>
                            <action-name>IsNoWtInterventionOutstanding</action-name>
                        </action>
                    </rule>                
                    <!-- CheckSkipBagging ensures that the threshold has not been
                        reached.  If it has, then it will generate an exception and
                        return a false to end the chain -->
                    <rule>
                        <action>
                            <action-name>CheckSkipBagging</action-name>
							<parameter>
								<value>check-skip-bagging-threshold</value>
							</parameter>                                                        
                        </action>
                        <!-- This action will execute in the event that the skip bagging
                            threshold has been exceeded. -->
                        <on-failure-action>
                            <action-name>SetLastGoodWeight</action-name>
                            <parameter>
                                <value>set-lgw</value>
                            </parameter>
                        </on-failure-action>
                        <failure-transition>Wait Scale - Skip Bagging Pressed</failure-transition>                        
                    </rule>
                    <rule>
                        <action>
                            <action-name>UpdateWLDBZeroWt</action-name>
                        </action>
                    </rule>
                    <!-- This rule will "call" a set of rules in the Any section.  These
                         rules are common to handling a valid item -->
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Skip Bagging3</message-name>
                <message-rule-list>    
                    <rule>
                    	<action>
                            <action-name>assign-variable</action-name>
                        	<parameter>
                            		<value>skip_bagging_in_multi_pick_flag</value>
                        	</parameter>
                        	<parameter>
                            		<value>1</value>
                        	</parameter>
                         </action>
		    </rule>         
                    <!-- IsNoWtInterventionOutstanding will cause the SkipBagging to be
                        ignored if there is an existing oustanding intervention -->
                    <rule>
                        <action>
                            <action-name>IsNoWtInterventionOutstanding</action-name>
                        </action>
                    </rule>                
                    <!-- This rule will "call" a set of rules in the Any section.  These
                         rules are common to handling a valid item -->
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>            
	    <!-- TAR320897- -->
            <message>
                <message-name>Enter Scan And Bag</message-name>
                <message-rule-list>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
        
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Wait Scale                                                       -->
        <!-- Function:  The scale has been requested to read a weight.                -->
        <!-- Messages:                                                                -->
        <!--      Matched Wt                                                          -->
        <!--      Unmatched Wt                                                        -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Wait Scale</state-name>
            <message>
                <message-name>Clear All Exceptions No Change State</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>ClearDelayedException</action-name>
                            <parameter>
                                <value>flags-clear-remove-exception</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
						<action>
							<action-name>evaluate-expression</action-name>
							<parameter>
								<value>tare_only_flag==0</value>
							</parameter>
						</action>
					</rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Item Sold</message-name>
                <message-rule-list>
					<!-- 407200 - -->
                    <rule>
                    	<action>
                            <action-name>assign-variable</action-name>
                        	<parameter>
                            		<value>skip_bagging_in_multi_pick_flag</value>
                        	</parameter>
                        	<parameter>
                            		<value>0</value>
                        	</parameter>
                         </action>
					</rule>           
					<!-- 407200 - -->                     
                    <rule>
                        <action>
                            <action-name>increment-variable</action-name>
                            <parameter>
                                <value>X</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- Always need to set the hold weight -->
                    <rule>
                        <action>
                            <action-name>SetHoldWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ResetAtItemScanForTAB</action-name>
                        </action>
                    </rule>
                    <!-- AddItemToTransaction returns false if the item was not
                        scanned (i.e. keyed or picklist) -->
                    <rule>
                        <action>
                            <action-name>AddItemToTransaction</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>ItemNotScannedAdjustment</action-name>
                        </on-failure-action>
                        <failure-transition>Wait DB</failure-transition>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetHoldWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendDBRequest</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>start-timer</action-name>
                            <parameter>
                                <value>db_lookup_timer</value>
                            </parameter>
                            <parameter>
                                <value>1000</value>
                            </parameter>
                        </action>
                    </rule>
                    <success-transition>Wait DB</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Matched Wt</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>HandleTABMatchedWt</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>IsNotQuantityItem</action-name>
                        </action>
                        <failure-transition>Wait Scale - Quantity Item</failure-transition>
                    </rule>
                    <!-- This rule will "call" a set of rules in the Any section.  These
                         rules are common to handling a valid item -->
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Unmatched Increase</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>HandleTABUnmatchedIncrease</action-name>
                            <parameter>
                                <value>scan_and_bag_flag</value>
                            </parameter>
                            <parameter>
                                <value>bag_and_eas_flag</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-bad-weight</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <!-- We have accepted this weight, must be a new item.  Need
                        to tell the TAB about it. -->
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- This rule will "call" a set of rules in the Any section.  These
                         rules are common to handling a valid item -->
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
<!-- +TAR 276877 -->        
            <message>
                <message-name>BackToLGW</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>stop-timer</action-name>
                            <parameter>
                                <value>delayed_timer</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>stop-timer</action-name>
                            <parameter>
                                <value>forgiveness_timer</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>stop-timer</action-name>
                            <parameter>
                                <value>unexpected_decrease_timer</value>
                            </parameter>
                        </action>
                    </rule>
<!-- TAR291798
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </action>
                    </rule>
-->
                    <rule>
                        <action>
                            <action-name>ResetWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>CheckForExceptions</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>IsNotQuantityItem</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>ClearAllMismatchesThisItem</action-name>
                        </on-failure-action>
                    </rule>                    
                    <!-- TAB Issue 36 - Do not want to clear all wt exceptions, only
                        last outstanding wt exception. -->
                    <!-- TAR 277066 - Added parameter to action so that we do not
                        mistakenly tell SCOTAPP that RAP cleared this exception -->
                    <rule>
                        <action>
                            <action-name>ClearLastWtException</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
<!-- -TAR 276877 -->        
<!-- +TAR 278365 - Need to disallow Forgiveness and Delayed exceptions after quantity 
    item scanned.  Both are reenabled when the correct weight registers on scale -->        
            <message>
                <message-name>Throw Exception</message-name>
                <message-rule-list>
                    <!-- Do NOT allow forgiveness and delayed for 
                        quantity items. -->
                    <rule>
                        <action>
                            <action-name>IsNotQuantityItem</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>ThrowException</action-name>
                        </on-failure-action>
                    </rule>
                    <!-- All other items but quantity will come to here -->
                    <rule>
                        <action>
                            <action-name>SetForgivenessTimeout</action-name>
                            <parameter>
                                <value>forgiveness_timeout_value</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- This action checks to see if it can be forgiven.  If so,
                         then action will return a FALSE to break the chain -->
                    <rule>
                        <action>
                            <action-name>IsExceptionForgiven</action-name>
                            <parameter>
                                <value>finalize_flag</value>
                            </parameter>
                            <parameter>
                                <value>bag_and_eas_flag</value>
                            </parameter>
                            <parameter>
                                <value>scan_and_bag_flag</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>start-timer</action-name>
                            <parameter>
                                <value>forgiveness_timer</value>
                            </parameter>
                            <parameter>
                                <value>forgiveness_timeout_value</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <!-- This action checks to see if intervention is required.  If not,
                         then action will return a FALSE to break the chain -->
                    <rule>
                        <action>
                            <action-name>IsExceptionInterventionReq</action-name>
                            <parameter>
                                <value>scan_and_bag_flag</value>
                            </parameter>
                            <parameter>
                                <value>bag_and_eas_flag</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetDelayedTimeout</action-name>
                            <parameter>
                                <value>delayed_timeout_value</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- This action checks to see if the exception can be delayed.
                         If so, then action will return a FALSE to break the chain -->
                    <rule>
                        <action>
                            <action-name>IsExceptionDelayed</action-name>
                            <parameter>
                                <value>not_finalize_flag</value>
                            </parameter>
                            <parameter>
                                <value>not_complete_flag</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>start-timer</action-name>
                            <parameter>
                                <value>delayed_timer</value>
                            </parameter>
                            <parameter>
                                <value>delayed_timeout_value</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <!-- We made all checks and now must go ahead and send the
                         exception on to the application for processing -->
                    <rule>
                        <action>
                            <action-name>ThrowException</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
<!-- -TAR 278365 -->
            <message>
                <message-name>forgiveness_timer_timeout</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>UpdateWLDBForgivenMismatch</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ClearForgivenException</action-name>
                        </action>
                    </rule>
                    <!-- This rule will "call" a set of rules in the Any section.  These
                         rules are common to handling a valid item -->
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>delayed_timer_timeout</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>UpdateWLDBDelayedNewItemThreshold</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ClearDelayedException</action-name>
							<parameter>
								<value>flags-clear-report-only</value>
							</parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>evaluate-expression</action-name>
                            <parameter>
                                <value>attract_quiet_mode_violation==0</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Attract Quiet Mode Violation</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <!-- This rule will "call" a set of rules in the Any section.  These
                         rules are common to handling a valid item -->
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <!-- The "Clear Exception" message is received from the application when
                 the exception was cleared by the operator in store mode
                 at the lane -->
            <message>
                <message-name>Clear Exception</message-name>
                <message-rule-list>
                    <!-- This action will clear a single exception as indicated by
                        the id field in the message. -->
                    <rule>
                        <action>
                            <action-name>ClearException</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>evaluate-expression</action-name>
                            <parameter>
                                <value>attract_quiet_mode_violation==0</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Attract Quiet Mode Violation</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Attract Quiet Mode Violation</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>attract_quiet_mode_violation</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                            <parameter>
                                <value>set-lgw-no-expectation</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetBeginningTransLGW</action-name>
                            <parameter>
                                <value>set-beginningtranslgw-attract</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <!-- The "Clear Exception" message is received from the application when
                 the exception was cleared by the operator in store mode
                 at the lane -->
            <message>
                <message-name>Clear Exception - All Wt Changes</message-name>
                <message-rule-list>
                    <!-- This action will clear a single exception as indicated by
                        the id field in the message. -->
                    <rule>
                        <action>
                            <action-name>ClearException</action-name>
                        </action>
                    </rule>
                    <rule> <!-- +TAR 276582 -->
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </action>
                    </rule> <!-- -TAR 276582 -->
                    <!-- This rule will "call" a set of rules in the Any section.  These
                         rules are common to handling a valid item -->
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <!-- The "Clear All Exceptions" message is received from the application when
                 the customer has pressed the tender button -->
            <message>
                <message-name>Clear All Exceptions</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>ClearAllExceptions</action-name>
                        </action>
                    </rule>
<!-- TAR291798 -->
<!--                <success-transition>Item Entry</success-transition>
-->
                </message-rule-list>
            </message>
            <!-- The "Clear Exception  with Update" message is received from the
                application when the exception was cleared by RAP -->
            <message>
                <message-name>Clear Exception with Update</message-name>
                <message-rule-list>
                    <!-- This action will update the WLDB for the given item.
                        Note that this action is expecting an exception for a
                        mismatch. -->
                    <rule>
                        <action>
                            <action-name>UpdateWLDB</action-name>
                        </action>
                    </rule>
                    <rule>
                        <!-- This action will clear a single exception as indicated by
                            the id field in the message.  If the id field is negative,
                            then all exceptions must be cleared and the action will abort
                            and return false. -->
                        <action>
                            <action-name>ClearException</action-name>
                        </action>
                        <!-- This action will execute in the event that all exceptions
                            are being cleared,  i.e. the id was specified as '*' in
                            the KV -->
                        <on-failure-action>
                            <action-name>ClearAllExceptions</action-name>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <!-- This message is received when the skip bagging button is
                pressed -->
            <message>
                <message-name>Skip Bagging</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>skip-bagging</value>
                            </parameter>
                        </action>
                    </rule>
<!-- +TAR 278015 Forces TAB from UnpurchasedItemStopBelt2 to TestForScan -->                    
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>scale-reads-zero</value>
                            </parameter>
                        </action>
                    </rule>
<!-- -TAR 278015 -->                    
                    <rule>
                        <action>
                            <action-name>evaluate-expression</action-name>
                            <parameter>
                                <value>unexpected_decrease_flag!=0</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Skip Bagging2</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <!-- CheckSkipBagging ensures that the threshold has not been
                        reached.  If it has, then it will generate an exception and
                        return a false to end the chain -->
                    <rule>
                        <action>
                            <action-name>CheckSkipBagging</action-name>
							<parameter>
								<value>check-skip-bagging-threshold</value>
							</parameter>                                                        
                        </action>
                        <!-- This action will execute in the event that the skip bagging
                            threshold has been exceeded. -->
                        <on-failure-action>
                            <action-name>SetLastGoodWeight</action-name>
                            <parameter>
                                <value>set-lgw</value>
                            </parameter>
                        </on-failure-action>
                        <failure-transition>Wait Scale - Skip Bagging Pressed</failure-transition>
                    </rule>
                    <!-- This rule will "call" a set of rules in the Any section.  These
                         rules are common to handling a valid item -->
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Skip Bagging2</message-name>
                <message-rule-list>
                    <rule>
						<action>
                            <action-name>evaluate-expression</action-name>
                            <parameter>
                                <value>multi_pick_flag==0</value>
                            </parameter>
						</action>
                        <on-failure-action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Skip Bagging3</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <!-- IsNoWtInterventionOutstanding will cause the SkipBagging to be
                        ignored if there is an existing oustanding intervention -->
                    <rule>
                        <action>
                            <action-name>IsNoWtInterventionOutstanding</action-name>
                        </action>
                    </rule>                                
                    <!-- CheckSkipBagging ensures that the threshold has not been
                        reached.  If it has, then it will generate an exception and
                        return a false to end the chain -->
                    <rule>
                        <action>
                            <action-name>CheckSkipBagging</action-name>
							<parameter>
								<value>check-skip-bagging-threshold</value>
							</parameter>                                                        
                        </action>
                        <!-- This action will execute in the event that the skip bagging
                            threshold has been exceeded. -->
                        <on-failure-action>
                            <action-name>SetLastGoodWeight</action-name>
                            <parameter>
                                <value>set-lgw</value>
                            </parameter>
                        </on-failure-action>
                        <failure-transition>Wait Scale - Skip Bagging Pressed</failure-transition>
                    </rule>
                    <rule>
                        <action>
                            <action-name>UpdateWLDBZeroWt</action-name>
                        </action>
                    </rule>
                    <!-- This rule will "call" a set of rules in the Any section.  These
                         rules are common to handling a valid item -->
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
<!-- +TAR 278015 Tell app we're ready for the next item -->
                    <rule>
                        <action>
                            <action-name>SendTABStatus</action-name>
                            <parameter>
                                <value>enable-scanner</value>
                            </parameter>
                        </action>
                    </rule>
<!-- -TAR 278015 -->
                    <!-- Update the item count on the belt, since the customer has
                        indicated that the item will not be placed on the belt -->
                    <rule>
                        <action>
                            <action-name>decrement-variable</action-name>
                            <parameter>
                                <value>belt_item_count</value>
                            </parameter>
                        </action>
                        <failure-transition>Item Entry</failure-transition>
                    </rule>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Skip Bagging3</message-name>
                <message-rule-list>    
                    <rule>
                    	<action>
                            <action-name>assign-variable</action-name>
                        	<parameter>
                            		<value>skip_bagging_in_multi_pick_flag</value>
                        	</parameter>
                        	<parameter>
                            		<value>1</value>
                        	</parameter>
                         </action>
				    </rule>         
                    <!-- IsNoWtInterventionOutstanding will cause the SkipBagging to be
                        ignored if there is an existing oustanding intervention -->
                    <rule>
                        <action>
                            <action-name>IsNoWtInterventionOutstanding</action-name>
                        </action>
                    </rule>                
                    <!-- This rule will "call" a set of rules in the Any section.  These
                         rules are common to handling a valid item -->
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <!-- This message is received when the skip bagging button is
                pressed -->
            <message>
                <message-name>Bag Box Button Pressed</message-name>
                <message-rule-list>
                    <!-- CheckBagBox ensures that the threshold has not been
                        reached.  If it has, then it will generate an exception and
                        return a false to end the chain -->
                    <rule>
                        <action>
                            <action-name>CheckBagBox</action-name>
                        </action>
                    </rule>
                    <!-- This rule will "call" a set of rules in the Any section.  These
                         rules are common to handling a valid item -->
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <!-- This message is received when RAP has approved a zero wt
                entry -->
            <message>
                <message-name>RAP Approved Wt</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>HandleRAPApprovedWt</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>skip-bagging</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- This rule will "call" a set of rules in the Any section.  These
                         rules are common to handling a valid item -->
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Item Expired</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>HandleRAPApprovedWt</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>skip-bagging</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- +TAR 277490 Added to force reset of item -->
                    <!-- This rule will "call" a set of rules in the Any section.  These
                         rules are common to handling a valid item -->
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <!-- -TAR 277490 -->
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <message>  
                <message-name>Item Not Sellable</message-name>
                <message-rule-list>
                     <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>IsTransactionEmpty</action-name>
                        </action>
                        <failure-transition>Item Entry</failure-transition>
                    </rule>
                    <success-transition>Start</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Item Details</message-name>
                <message-rule-list>
                    <!-- This message is received from the application
                    when TB has finished selling the item.  The following
                    action will fail if the item is not marked as sellable -->
                    <rule>
                        <action>
                            <action-name>CheckItemDetails</action-name>
                        </action>
                        <on-failure-action>
			    <action-name>send-msg</action-name>
                            <parameter>
                                <value>Item Not Sellable</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                </message-rule-list>
            </message>
            <!-- SOTF5959 - TAR409459 Start -->
            <message>
                <message-name>Takeaway Belt - Ready</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>ReadyTABForNextItem</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendTABStatus</action-name>
                            <parameter>
                                <value>enable-scanner</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <success-transition>Item Entry</success-transition>                        
                </message-rule-list>
            </message>
            <!-- SOTF5959 - TAR409459 End -->
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Wait Scale - Skip Bagging Pressed                                -->
        <!-- Function:  The Skip Bagging button has been pressed and we have exceeded -->
        <!--            the threshold.  We are now waiting for the attendant to clear -->
        <!-- Messages:                                                                -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Wait Scale - Skip Bagging Pressed</state-name>
<!-- +TAR 278015 Tell app we're OK -->
            <exit-rule-list>
                <rule>
                    <action>
                        <action-name>SendTABStatus</action-name>
                        <parameter>
                            <value>enable-scanner</value>
                        </parameter>
                    </action>
                </rule>
            </exit-rule-list>
<!-- -TAR 278015 -->
            <!-- The "Clear Exception  with Update" message is received from the
                application when the exception was cleared by RAP -->
            <message>
                <message-name>Clear Exception</message-name>
                <message-rule-list>
                    <!-- This action will update the WLDB for the given item.
                        Note that this action is expecting an exception for a
                        mismatch. -->
                    <rule>
                        <action>
                            <action-name>UpdateWLDBZeroWt</action-name>
                        </action>
                    </rule>
                    <rule>
                        <!-- This action will clear a single exception as indicated by
                            the id field in the message.  If the id field is negative,
                            then all exceptions must be cleared and the action will abort
                            and return false. -->
                        <action>
                            <action-name>ClearException</action-name>
                        </action>
                        <!-- This action will execute in the event that all exceptions
                            are being cleared,  i.e. the id was specified as '*' in
                            the KV -->
                        <on-failure-action>
                            <action-name>ClearAllExceptions</action-name>
                        </on-failure-action>
                        <failure-transition>Item Entry</failure-transition>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Clear Exception - All Wt Changes</message-name>
                <message-rule-list>
<!-- 389091+ -->
		         <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>UI_SkipBagging_threshold</value>
                        </parameter>
                        <parameter>
                            <value>0</value>
                        </parameter>
                    </action>
                </rule>
<!-- 389091- -->
                    <rule>
                        <!-- This action will clear the wt change related
                            exceptions only. -->
                        <action>
                            <action-name>ClearException</action-name>
                        </action>
                    </rule>
<!-- 389091+ -->
                    <rule>
                        <action>
                            <action-name>CheckScaleNotEmpty</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>zero-weight</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>flush-and-finish</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                            <parameter>
                                <value>set-beginning-lgw</value>
                            </parameter>
                        </action>
                    </rule>
<!-- 389091- -->
                </message-rule-list>
            </message>
            <message>
                <message-name>delayed_timer_timeout</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Clear Delayed Exception</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
<!-- TAR 388427+ -->
            <message>
                <message-name>Unmatched Increase</message-name>
                <message-rule-list>
<!-- 389091+ -->
		          <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>UI_SkipBagging_threshold</value>
                        </parameter>
                        <parameter>
                            <value>1</value>
                        </parameter>
                    </action>
                </rule>
<!-- 389091- -->
                    <rule>
                        <action>
                            <action-name>HandleShuffle</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>HandleTABUnmatchedIncrease</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-bad-weight</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>CheckScaleNotEmpty</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>zero-weight</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>flush-and-finish</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                            <parameter>
                                <value>set-beginning-lgw</value>
                            </parameter>
                        </action>
                    </rule>
               </message-rule-list>
            </message>
<!-- TAR 388427- -->
            <message>
                <message-name>BackToLGW</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>ResetWeight</action-name>
                        </action>
                    </rule>
<!-- TAR389091+ -->
                    <rule>
                        <action>
                            <action-name>CheckForExceptions</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>evaluate-expression</action-name>
                            <parameter>
                                <value>UI_SkipBagging_threshold==0</value>
                            </parameter>
                        </action>
                        <on-failure-action>
<!-- TAR412886 -->          <action-name>ClearAllWtExceptions</action-name>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>CheckForExceptions</action-name>
                        </action>
                        <failure-transition>Item Entry</failure-transition>
                    </rule>
                </message-rule-list>
             </message>
             <message>
                <message-name>Unmatched Wt</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>HandleTABUnmatchedWt</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Wait Scale - Skipbagging - flush</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
             </message-rule-list>
            </message>
            <message>
                <message-name>Wait Scale - Skipbagging - flush</message-name>
            </message>
<!-- tar389091- -->
            <message>
                <message-name>Exit Assist Mode</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>ClearHoldWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ValidateItem</action-name>
                        </action>
                    </rule>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Enter Scan And Bag</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Transaction Continue</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Transaction Continue</message-name>
                <message-rule-list>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Wait Scale - Quantity Item                                       -->
        <!-- Function:  A quantity item has been scanned.  Waiting for scale to clear -->
        <!-- Messages:                                                                -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Wait Scale - Quantity Item</state-name>
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>SetLastGoodWeight</action-name>
                    </action>
                </rule>
                <!-- This rule will "call" a set of rules in the Any section.  These
                        rules are common to handling a valid item -->
                <rule>
                    <action>
                        <action-name>ValidateItem</action-name>
                    </action>
                </rule>
            </entry-rule-list>
<!-- +TAR 276877 -->        
            <exit-rule-list>
                <rule>
                    <action>
                        <action-name>ReadyTABForNextItem</action-name>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>SendTABStatus</action-name>
                        <parameter>
                            <value>enable-scanner</value>
                        </parameter>
                    </action>
                </rule>
            </exit-rule-list>
<!-- -TAR 276877 -->        
            <message>
                <message-name>Unmatched Increase</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>HandleTABQuantityUnmatchedIncrease</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>HandleTABUnmatchedIncrease</action-name>
                            <parameter>
                                <value>scan_and_bag_flag</value>
                            </parameter>
                            <parameter>
                                <value>bag_and_eas_flag</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Unmatched Decrease</message-name>
                <message-rule-list>
<!-- TAR 276877 
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                            <parameter>
                                <value>set-beginning-lgw</value>
                            </parameter>
                        </action>
                    </rule>
-->                    
                    <rule>
                        <action>
                            <action-name>CheckScaleNotEmpty</action-name>
                        </action>
                        <failure-transition>Item Entry</failure-transition>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>BackToLGW</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>ResetWeight</action-name>
                        </action>
                    </rule>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Takeaway Belt - Scale Status Requested</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Takeaway Belt - Item Moved Off Belt1</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>decrement-variable</action-name>
                            <parameter>
                                <value>belt_item_count</value>
                            </parameter>
                        </action>
                    </rule>
<!-- TAR 276877
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                            <parameter>
                                <value>set-beginning-lgw</value>
                            </parameter>
                        </action>
                    </rule>
-->                    
                    <rule>
                        <action>
                            <action-name>CheckScaleNotEmpty</action-name>
                        </action>
                        <failure-transition>Item Entry</failure-transition>
                    </rule>
                </message-rule-list>
            </message>
<!-- +TAR 276877 -->
            <message>
                <message-name>Takeaway Belt - Ready</message-name>
            </message>
<!-- -TAR 276877 -->
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Item Entry                                                       -->
        <!-- Function:  The scale has been requested to read a weight.                -->
        <!-- Messages:                                                                -->
        <!--      Matched Wt                                                          -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Item Entry</state-name>
            <message>
                <message-name>Item Sold</message-name>
                <message-rule-list>
					<!-- 407200 - -->
                    <rule>
                    	<action>
                            <action-name>assign-variable</action-name>
                        	<parameter>
                            		<value>skip_bagging_in_multi_pick_flag</value>
                        	</parameter>
                        	<parameter>
                            		<value>0</value>
                        	</parameter>
                         </action>
					</rule>           
					<!-- 407200 - -->                     
                    <rule>
                        <action>
                            <action-name>increment-variable</action-name>
                            <parameter>
                                <value>X</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- Always need to set the hold weight -->
                    <rule>
                        <action>
                            <action-name>SetHoldWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ResetAtItemScanForTAB</action-name>
                        </action>
                    </rule>
	     	    <rule>
                        <action>
                            <action-name>increment-variable</action-name>
                            <parameter>
                                <value>belt_item_count</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>item-scan</value>
                            </parameter>
                        </action>
                    </rule>
                    <!-- AddItemToTransaction returns false if the item was not
                        scanned (i.e. keyed or picklist) -->
                    <rule>
                        <action>
                            <action-name>AddItemToTransaction</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>ItemNotScannedAdjustment</action-name>
                        </on-failure-action>
                        <failure-transition>Wait DB</failure-transition>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetHoldWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendDBRequest</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>start-timer</action-name>
                            <parameter>
                                <value>db_lookup_timer</value>
                            </parameter>
                            <parameter>
                                <value>1000</value>
                            </parameter>
                        </action>
                    </rule>
                    <success-transition>Wait DB</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Bag Box Button Pressed</message-name>
                <message-rule-list>
                    <!-- CheckBagBox ensures that the threshold has not been
                        reached.  If it has, then it will generate an exception and
                        return a false to end the chain -->
                    <rule>
                        <action>
                            <action-name>CheckBagBox</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Transaction Finalize</message-name>
                <message-rule-list>
                    <success-transition>Finalize</success-transition>
                </message-rule-list>
            </message>
            <!-- The Picking Up Items timer in app expired.  -->
            <message>
                <message-name>Item Expired</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Item Void Begin</message-name>
                <message-rule-list>
                    <success-transition>Item Voided</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM Begin</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>push-state</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SMMBegin</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                        <failure-transition>Security Maintenance</failure-transition>
                    </rule>
                    <success-transition>Security Maintenance</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Clear Exception with Update</message-name>
                <message-rule-list>
					<!-- This action will update the WLDB for the given item. Note that this action is expecting an exception for a mismatch. -->
                    <rule>
                        <action>
                            <action-name>UpdateWLDB</action-name>
                        </action>
                    </rule>
                   <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                   <rule>
                        <action>
                            <action-name>ClearException</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Item Voided                                                      -->
        <!-- Function:  State for handling voided item                                -->
        <!-- Messages:                                                                -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Item Voided</state-name>
            <exit-rule-list>
                <rule>
                    <action>
                        <action-name>SetLastGoodWeight</action-name>
                        <parameter>
                            <value>set-lgw-no-expectation</value>
                        </parameter>
                    </action>
                </rule>
            </exit-rule-list>
            <message>
                <message-name>Item Details</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>RemoveItemFromTransaction</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Unmatched Decrease</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>HandleUnmatchedIncreaseLateCorrection</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Void Item Late Correction</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Void Item Late Correction</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>ClearLastWtException</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Item Void End</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>IsTransactionEmpty</action-name>
                        </action>
                        <failure-transition>Item Entry</failure-transition>
                    </rule>
                    <success-transition>Start</success-transition>
                </message-rule-list>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Transaction Voided                                                      -->
        <!-- Function:  State for handling voided item                                -->
        <!-- Messages:                                                                -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Transaction Voided</state-name>
            <message>
                <message-name>Unmatched Decrease</message-name>
            </message>
            <message>
                <message-name>Transaction Continue</message-name>
                <message-rule-list>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Transaction Void End</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>VoidTransaction</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ClearOutstandingExceptions</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ReadScaleForZero</action-name>
                        </action>
                        <failure-transition>Complete</failure-transition>
                    </rule>
                    <success-transition>Complete</success-transition>
                </message-rule-list>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Finalize                                                         -->
        <!-- Function:                                                                -->
        <!-- Messages:                                                                -->
        <!--      Unmatched Wt                                                        -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Finalize</state-name>
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>finalize_flag</value>
                        </parameter>
                        <parameter>
                            <value>1</value>
                        </parameter>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>not_finalize_flag</value>
                        </parameter>
                        <parameter>
                            <value>0</value>
                        </parameter>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>DisableLateCorrection</action-name>
                    </action>
                </rule>
            </entry-rule-list>
            <exit-rule-list>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>finalize_flag</value>
                        </parameter>
                        <parameter>
                            <value>0</value>
                        </parameter>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>not_finalize_flag</value>
                        </parameter>
                        <parameter>
                            <value>1</value>
                        </parameter>
                    </action>
                </rule>
            </exit-rule-list>
                <!-- We sometimes end up in Finalize while FL is in S&B and the Skip-bagging button doesn't work -->
            <message>
                <message-name>Enter Scan And Bag</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Transaction Continue</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Transaction Continue</message-name>
                <message-rule-list>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Throw Exception</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SetForgivenessTimeout</action-name>
                            <parameter>
                                <value>forgiveness_timeout_value</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>IsExceptionForgiven</action-name>
                            <parameter>
                                <value>finalize_flag</value>
                            </parameter>
                        </action>
                        <on-failure-action>
                            <action-name>start-timer</action-name>
                            <parameter>
                                <value>forgiveness_timer</value>
                            </parameter>
                            <parameter>
                                <value>forgiveness_timeout_value</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ThrowException</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <!-- Allow unmatched decrease in this state. -->
            <message>
                <message-name>Unmatched Decrease</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SaveLastRemovedWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ClearAllExceptions</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Unmatched Increase</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>HandleShuffle</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SetLastGoodWeight</action-name>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>HandleTABUnmatchedIncrease</action-name>
                            <parameter>
                                <value>scan_and_bag_flag</value>
                            </parameter>
                            <parameter>
                                <value>bag_and_eas_flag</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM Begin</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>push-state</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SMMBegin</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                        <failure-transition>Security Maintenance</failure-transition>
                    </rule>
                    <success-transition>Security Maintenance</success-transition>
                </message-rule-list>
            </message>
<!-- 455182+ -->
            <message>
                <message-name>Transaction End</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>CheckTransactionComplete</action-name>
                        </action>
                        <failure-transition>Complete</failure-transition>
                    </rule>
                    <success-transition>Complete</success-transition>
                </message-rule-list>
            </message>
<!-- 455182- -->
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Complete                                                         -->
        <!-- Function:                                                                -->
        <!-- Messages:                                                                -->
        <!--      Unmatched Wt                                                        -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Complete</state-name>
            <!-- On entry to Complete, the following list of actions will be executed -->
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>not_complete_flag</value>
                        </parameter>
                        <parameter>
                            <value>0</value>
                        </parameter>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>ClearHoldWeight</action-name>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>ReadScaleForZero</action-name>
                    </action>
<!-- +TAR 278124 -->            
                    <on-failure-action>
                        <action-name>send-msg</action-name>
                        <parameter>
                            <value>Scale Not Empty</value>
                        </parameter>
                    </on-failure-action>
<!-- -TAR 278124 -->            
                </rule>
            </entry-rule-list>
            <exit-rule-list>
                <rule>
                    <action>
                        <action-name>assign-variable</action-name>
                        <parameter>
                            <value>not_complete_flag</value>
                        </parameter>
                        <parameter>
                            <value>1</value>
                        </parameter>
                    </action>
                </rule>
            </exit-rule-list>

<!-- SSCOB-1192+ -->
            <message>
                <message-name>BackToLGW</message-name>
                <message-rule-list>
                    <rule>
                    <action>
                        <action-name>send-msg</action-name>
                            <parameter>
                                <value>CheckForReadScaleForZero</value>
                            </parameter>
                    </action>
                    </rule>
                </message-rule-list>
            </message>
<!-- SSCOB-1192- -->

<!-- +TAR 278124 -->            
            <message>
                <message-name>Scale Not Empty</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>CheckForExceptions</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>flush-and-finish</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                </message-rule-list>
            </message>
<!-- -TAR 278124 -->            
            <message>
                <message-name>Unmatched Wt</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>CheckScaleNotEmpty</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Zero Wt</value>
                            </parameter>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>HandleTABUnmatchedWt</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
             <message>
                <message-name>Takeaway Belt - Ready</message-name>
                <message-rule-list>
                </message-rule-list>
            </message>
           <message>
                <message-name>Zero Wt</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>ClearAllExceptions</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ResetTransaction</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendTransactionComplete</action-name>
                        </action>
                    </rule>
                    <success-transition>Idle</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Unmatched Decrease</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SaveLastRemovedWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Unmatched Increase</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>HandleShuffle</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SetLastGoodWeight</action-name>
                        </on-failure-action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>HandleTABUnmatchedIncrease</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Transaction Expired</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SetBeginningTransLGW</action-name>
                            <parameter>
                                <value>set-beginningtranslgw-attract</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Zero Wt</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
           <message>
                <message-name>Takeaway Belt - Ready</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>ReadyTABForNextItem</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendTABStatus</action-name>
                            <parameter>
                                <value>enable-scanner</value>
                            </parameter>
                        </action>
                    </rule>
           	 <rule>
	    	     <action>
                         <action-name>CheckScaleNotEmpty</action-name>
                     </action>
                     <on-failure-action>
                         <action-name>send-msg</action-name>
                            <parameter>
                        	 <value>Zero Wt</value>
                            </parameter>
                     </on-failure-action>
                </rule>
                </message-rule-list>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Security Maintenance                                             -->
        <!-- Function:                                                                -->
        <!-- Messages:                                                                -->
        <!--      Unmatched Wt                                                        -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Security Maintenance</state-name>
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>SetSMMCurrentWeight</action-name>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>ClearHoldWeight</action-name>
                    </action>
                </rule>
            </entry-rule-list>
            <message>
                <message-name>SMM Query</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SMMQuery</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM Tolerance</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SaveSMMToleranceData</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>GetSMMWLDBData</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>DB Response</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SMMDBResponse</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM WLDB Weight</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>increment-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>BuildSMMQueryResponse</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendSMMQueryResponse</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM Update - Add Weight</message-name>
                <message-rule-list>
                    <success-transition>Security Maintenance - Add Weight</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM Update - Add Zero</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SMMUpdateDeleteAllWts</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                        <failure-transition>Security Maintenance</failure-transition>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SMMUpdateDeleteAllWts</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                        <failure-transition>Security Maintenance</failure-transition>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SMMUpdateAddZero</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                        <failure-transition>Security Maintenance</failure-transition>
                    </rule>
                    <success-transition>Security Maintenance - Add Zero Wt</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM Update - Add Tolerance</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SMMCheckToleranceValue</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMUpdateAddToleranceResponse</action-name>
                        </on-failure-action>
                        <failure-transition>Security Maintenance</failure-transition>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SMMUpdateAddTolerance</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                        <failure-transition>Security Maintenance</failure-transition>
                    </rule>
                    <success-transition>Security Maintenance - Add Tolerance</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM Update - Delete Tolerance</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SMMUpdateDeleteTolerance</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                        <failure-transition>Security Maintenance</failure-transition>
                    </rule>
                    <success-transition>Security Maintenance - Delete Tolerance</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM Update - Delete All Weights</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SMMUpdateDeleteAllWts</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                        <failure-transition>Security Maintenance</failure-transition>
                    </rule>
                    <success-transition>Security Maintenance - Delete All Wts</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM Update - Add Substitution Check</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SMMUpdateAddSubstitutionCheck</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                        <failure-transition>Security Maintenance</failure-transition>
                    </rule>
                    <success-transition>Security Maintenance - Add Substitution Check</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM Update - Add Wt Required</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SMMUpdateAddWtRequired</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                        <failure-transition>Security Maintenance</failure-transition>
                    </rule>
                    <success-transition>Security Maintenance - Add Wt Required</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM End</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SMMEnd</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>pop-state</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Unmatched Decrease</message-name>
            </message>
            <message>
                <message-name>Unmatched Increase</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>HandleSMMUnmatchedIncrease</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendSMMObservedWeight</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <!-- +TAB Issue 45 -->
            <message>
                <message-name>BackToLGW</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>ResetWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ResetSMMObservedWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendSMMObservedWeight</action-name>
                            <parameter>
                                <value>read-from-scale</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <!-- -TAB Issue 45 -->
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Security Maintenance - Add Weight                                -->
        <!-- Function:                                                                -->
        <!-- Messages:                                                                -->
        <!--      Unmatched Wt                                                        -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Security Maintenance - Add Weight</state-name>
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>SetSMMCurrentWeight</action-name>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>SetLastGoodWeight</action-name>
                    </action>
                </rule>
            </entry-rule-list>
            <!-- +TAR 276873 -->
            <message>
                <message-name>Unmatched Wt</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>HandleTABUnmatchedWt</action-name>
                            <parameter>
                                <value>allow-all</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <!-- -TAR 276873 -->
            <message>
                <message-name>Unmatched Increase</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>HandleSMMUnmatchedIncrease</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SMMAddWtToWLDB</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM WLDB Update Complete</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SMMQuery</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM Tolerance</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SaveSMMToleranceData</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>GetSMMWLDBData</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>DB Response</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SMMDBResponse</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM WLDB Weight</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>increment-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>BuildSMMQueryResponse</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendSMMQueryResponse</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <success-transition>Security Maintenance</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM Cancel</message-name>
                <message-rule-list>
                    <success-transition>Security Maintenance</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Unmatched Decrease</message-name>
                <rule>
                    <action>
                        <action-name>SetLastGoodWeight</action-name>
                    </action>
                </rule>
                <rule>
                    <action>
                        <action-name>SetSMMCurrentWeight</action-name>
                    </action>
                </rule>
            </message>
            <!-- BackToLGW was causing the belt to move.  Added this to ignore
                the BackToLGW message since belt should not move in SMM -->
            <message>
                <message-name>BackToLGW</message-name>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Security Maintenance - Add Tolerance                                -->
        <!-- Function:                                                                -->
        <!-- Messages:                                                                -->
        <!--                                                              -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Security Maintenance - Add Tolerance</state-name>
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>SetHoldWeight</action-name>
                    </action>
                </rule>
            </entry-rule-list>
			<exit-rule-list>
                <rule>
                    <action>
                        <action-name>ClearHoldWeight</action-name>
                    </action>
                </rule>
            </exit-rule-list>
            <message>
                <message-name>SMM Tolerance</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>GetSMMWLDBData</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>DB Response</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SMMDBResponse</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM WLDB Weight</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>increment-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>BuildSMMQueryResponse</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendSMMQueryResponse</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <success-transition>Security Maintenance</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM Cancel</message-name>
                <message-rule-list>
                    <success-transition>Security Maintenance</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Unmatched Wt</message-name>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Security Maintenance - Add Substitution Check                                -->
        <!-- Function:                                                                -->
        <!-- Messages:                                                                -->
        <!--                                                              -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Security Maintenance - Add Substitution Check</state-name>
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>SetHoldWeight</action-name>
                    </action>
                </rule>
            </entry-rule-list>
			<exit-rule-list>
                <rule>
                    <action>
                        <action-name>ClearHoldWeight</action-name>
                    </action>
                </rule>
            </exit-rule-list>
            <message>
                <message-name>SMM Tolerance</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>GetSMMWLDBData</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>DB Response</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SMMDBResponse</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM WLDB Weight</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>increment-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>BuildSMMQueryResponse</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendSMMQueryResponse</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <success-transition>Security Maintenance</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM Cancel</message-name>
                <message-rule-list>
                    <success-transition>Security Maintenance</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Unmatched Wt</message-name>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Security Maintenance - Add Wt Required                                -->
        <!-- Function:                                                                -->
        <!-- Messages:                                                                -->
        <!--                                                              -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Security Maintenance - Add Wt Required</state-name>
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>SetHoldWeight</action-name>
                    </action>
                </rule>
            </entry-rule-list>
			<exit-rule-list>
                <rule>
                    <action>
                        <action-name>ClearHoldWeight</action-name>
                    </action>
                </rule>
            </exit-rule-list>
            <message>
                <message-name>SMM Tolerance</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>GetSMMWLDBData</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>DB Response</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SMMDBResponse</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM WLDB Weight</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>increment-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>BuildSMMQueryResponse</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendSMMQueryResponse</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <success-transition>Security Maintenance</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM Cancel</message-name>
                <message-rule-list>
                    <success-transition>Security Maintenance</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Unmatched Wt</message-name>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Security Maintenance - Add Zero Wt                                -->
        <!-- Function:                                                                -->
        <!-- Messages:                                                                -->
        <!--                                                             -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Security Maintenance - Add Zero Wt</state-name>
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>SetHoldWeight</action-name>
                    </action>
                </rule>
            </entry-rule-list>
			<exit-rule-list>
                <rule>
                    <action>
                        <action-name>ClearHoldWeight</action-name>
                    </action>
                </rule>
            </exit-rule-list>
            <message>
                <message-name>SMM WLDB Update Complete</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SMMQuery</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM Tolerance</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>GetSMMWLDBData</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>DB Response</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SMMDBResponse</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM WLDB Weight</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>increment-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>BuildSMMQueryResponse</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendSMMQueryResponse</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <success-transition>Security Maintenance</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Unmatched Wt</message-name>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Security Maintenance - Delete All Wts                                -->
        <!-- Function:                                                                -->
        <!-- Messages:                                                                -->
        <!--                                                            -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Security Maintenance - Delete All Wts</state-name>
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>SetHoldWeight</action-name>
                    </action>
                </rule>
            </entry-rule-list>
			<exit-rule-list>
                <rule>
                    <action>
                        <action-name>ClearHoldWeight</action-name>
                    </action>
                </rule>
            </exit-rule-list>
            <message>
                <message-name>SMM WLDB Update Complete</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SMMQuery</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM Tolerance</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>GetSMMWLDBData</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>DB Response</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SMMDBResponse</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM WLDB Weight</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>increment-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>BuildSMMQueryResponse</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendSMMQueryResponse</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <success-transition>Security Maintenance</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Unmatched Wt</message-name>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Security Maintenance - Delete Tolerance                                -->
        <!-- Function:                                                                -->
        <!-- Messages:                                                                -->
        <!--                                                            -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Security Maintenance - Delete Tolerance</state-name>
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>SetHoldWeight</action-name>
                    </action>
                </rule>
            </entry-rule-list>
			<exit-rule-list>
                <rule>
                    <action>
                        <action-name>ClearHoldWeight</action-name>
                    </action>
                </rule>
            </exit-rule-list>
            <message>
                <message-name>SMM Tolerance</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>GetSMMWLDBData</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>SendSMMServerFailure</action-name>
                        </on-failure-action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>DB Response</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SMMDBResponse</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>SMM WLDB Weight</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>increment-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>BuildSMMQueryResponse</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendSMMQueryResponse</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>assign-variable</action-name>
                            <parameter>
                                <value>SMM_WLDB_wt_entry_counter</value>
                            </parameter>
                            <parameter>
                                <value>0</value>
                            </parameter>
                        </action>
                    </rule>
                    <success-transition>Security Maintenance</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Unmatched Wt</message-name>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Assist Mode                                                      -->
        <!-- Function:  State for handling items in assist mode                       -->
        <!-- Messages:                                                                -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Assist Mode</state-name>
            <entry-rule-list>
                <rule>
                    <action>
                        <action-name>SetHoldWeight</action-name>
                    </action>
                </rule>
            </entry-rule-list>
            <!-- +TAR287456 -->
            <message>
                <message-name>Transaction Begin</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>StartTransaction</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetBeginningTransLGW</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>CheckForExceptions</action-name>
                        </action>
						<!-- TAR 310488 / 336337
					   	 	 failure-transition>Start</failure-transition -->
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
					<!-- TAR 310488 / 336337 
							success-transition>Start</success-transition -->
                </message-rule-list>
            </message>
            <message>
                <message-name>Dept Details</message-name>
            </message>
            <!-- -TAR287456 -->
            <message>
                <message-name>Item Sold</message-name>
                <message-rule-list>
					<!-- 407200 - -->
                    <rule>
                    	<action>
                            <action-name>assign-variable</action-name>
                        	<parameter>
                            		<value>skip_bagging_in_multi_pick_flag</value>
                        	</parameter>
                        	<parameter>
                            		<value>0</value>
                        	</parameter>
                         </action>
					</rule>           
					<!-- 407200 - -->                     
                    <rule>
                        <action>
                            <action-name>ResetAtItemScanForTAB</action-name>
                        </action>
                    </rule>
                    <!-- AddItemToTransaction returns false if the item was not
                        scanned (i.e. keyed or picklist) -->
                    <rule>
                        <action>
                            <action-name>AddItemToTransaction</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>ItemNotScannedAdjustment</action-name>
                        </on-failure-action>
                        <failure-transition>Assist Mode - Item In Progress</failure-transition>
                    </rule>
                    <success-transition>Assist Mode - Item In Progress</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Exit Assist Mode</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>pop-state</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
	    <message>
                <message-name>Enter Scan And Bag</message-name>
                <message-rule-list>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Transaction Void Begin</message-name>
                <message-rule-list>
                    <success-transition>Assist Mode</success-transition>
                </message-rule-list>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Assist Mode - Item In Progress                                   -->
        <!-- Function:  ItemSold has been received and we are waiting on the details  -->
        <!-- Messages:                                                                -->
        <!--      DB Response                                                         -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Assist Mode - Item In Progress</state-name>
            <message>
                <message-name>Item Details</message-name>
                <message-rule-list>
                    <!-- This message is received from the application
                    when TB has finished selling the item.  The following
                    action will fail if the item is not marked as sellable -->
                    <rule>
                        <action>
                            <action-name>CheckItemDetails</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stop-belt</value>
                            </parameter>
                        </on-failure-action>
                        <failure-transition>Assist Mode</failure-transition>
                    </rule>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>item-scan</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>NotifyTakeawayBelt</action-name>
                            <parameter>
                                <value>stable-good-weight</value>
                            </parameter>
                        </action>
                    </rule>
                    <success-transition>Assist Mode</success-transition>
                </message-rule-list>
            </message>
	    <message>
                <message-name>Enter Scan And Bag</message-name>
                <message-rule-list>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
        </state>
        <!-- ======================================================================== -->
        <!-- State:  Remote Assist Mode                                               -->
        <!-- Function:  State for handling items in assist mode.  Ignores weight      -->
        <!-- changes until exit time.  Does not move the belt because during this     -->
        <!-- state, cashier is at RAP terminal not at the lane.  Do not want to let   -->
        <!-- customer or proxy at lane add anything to belt and have it transported.  -->
        <!-- ======================================================================== -->
        <state>
            <state-name>Remote Assist Mode</state-name>
            <message>
                <message-name>Item Details</message-name>
                <message-rule-list>
                    <!-- This message is received from the application
                    when TB has finished selling the item.  The following
                    action will fail if the item is not marked as sellable -->
                    <rule>
                        <action>
                            <action-name>CheckItemDetails</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Transaction Begin</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>StartTransaction</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetBeginningTransLGW</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>CheckForExceptions</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Dept Details</message-name>
            </message>
            <!-- -TAR287456 -->
            <message>
                <message-name>Item Sold</message-name>
                <message-rule-list>
					<!-- 407200 - -->
                    <rule>
                    	<action>
                            <action-name>assign-variable</action-name>
                        	<parameter>
                            		<value>skip_bagging_in_multi_pick_flag</value>
                        	</parameter>
                        	<parameter>
                            		<value>0</value>
                        	</parameter>
                         </action>
					</rule>           
					<!-- 407200 - -->                     
                    <rule>
                        <action>
                            <action-name>ResetAtItemScanForTAB</action-name>
                        </action>
                    </rule>
                    <!-- AddItemToTransaction returns false if the item was not
                        scanned (i.e. keyed or picklist) -->
                    <rule>
                        <action>
                            <action-name>AddItemToTransaction</action-name>
                        </action>
                        <on-failure-action>
                            <action-name>ItemNotScannedAdjustment</action-name>
                        </on-failure-action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Exit Remote Assist Mode</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>pop-state</action-name>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
    	    <message>
                <message-name>Enter Scan And Bag</message-name>
                <message-rule-list>
                    <success-transition>Item Entry</success-transition>
                </message-rule-list>
            </message>
            <message>
                <message-name>Takeaway Belt - Ready</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SendTABStatus</action-name>
                            <parameter>
                                <value>enable-scanner</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <!-- +TAR 394135 -->
            <message>
                <!-- This is an application control message used to tell
                    security to resume sending weight messages -->
                <message-name>Resume Weight Command</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>SetLastGoodWeight</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SetBeginningTransLGW</action-name>
                            <parameter>
                                <value>set-beginningtranslgw-attract</value>
                            </parameter>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>send-msg</action-name>
                            <parameter>
                                <value>Zero Wt</value>
                            </parameter>
                        </action>
                    </rule>
                </message-rule-list>
            </message>
            <message>
                <message-name>Zero Wt</message-name>
                <message-rule-list>
                    <rule>
                        <action>
                            <action-name>ClearAllExceptions</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>ResetTransaction</action-name>
                        </action>
                    </rule>
                    <rule>
                        <action>
                            <action-name>SendTransactionComplete</action-name>
                        </action>
                    </rule>
                    <success-transition>Remote Assist Mode</success-transition>
                </message-rule-list>
            </message>
            <!-- -TAR 394135 -->            
        </state>
    </rules>
</state-machine>
